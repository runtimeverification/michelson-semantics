parameter string ;
storage (map string int) ;
code {
       # verify balance is sufficient to run contract
       AMOUNT ;
       PUSH mutez 5000000 ;
       COMPARE ; GT ;
       IF { FAIL } { } ;

       # get the storage (map) and parameter (string key)
       DUP ; DIP { CDR ; DUP } ; CAR ; DUP ;

       # lookup map[key] and return Some (map[key] + 1)
       DIP { GET ; ASSERT_SOME ;
             PUSH int 1 ; ADD ; SOME } ;

       # assign map[key] := map[key] + 1
       UPDATE ;

       # update map in storage
       NIL operation; PAIR
     } ;

amount 5000001 ;

input  { Stack_elt (pair string           (map string int)) $I } ;
output { Stack_elt (pair (list operation) (map string int)) $O } ;

precondition  { { PUSH (pair string (map string int)) $I ; UNPAIR ; MEM } } ;
postcondition { { PUSH (pair string (map string int)) $I
                  ; UNPAIR
                  ; GET
                  ; IF_NONE { PUSH bool False }
                            { PUSH int 1
                            ; ADD
                            ; PUSH (pair (list operation) (map string int)) $O
                            ; CDR
                            ; PUSH (pair string (map string int)) $I ; CAR
                            ; GET
                            ; IF_NONE { PUSH bool False }
                                      { COMPARE ; EQ    }
                            }
                 }
               }
