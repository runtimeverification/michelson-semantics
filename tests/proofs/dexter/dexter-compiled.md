```k
requires "../../../pretty-syntax.md"
module DEXTER-COMPILED
  imports MICHELSON-PRETTY-SYNTAX
  imports BOOL
```

# Purpose

This module contains the compiled Dexter code for version FA1.2 and FA2.
The macros `#dexterCodeFA12` and `#dexterCodeFA2` translate to the respective Michelson code.
We have pasted the code verbatim:
https://gitlab.com/dexter2tz/dexter2tz/-/blob/8a5792a56e0143042926c3ca8bff7d7068a541c3/dexter.mligo.tz
https://gitlab.com/dexter2tz/dexter2tz/-/blob/8a5792a56e0143042926c3ca8bff7d7068a541c3/dexter.fa2.mligo.tz

# The Dexter Smart Contract Code

```k
  syntax Data ::= "#dexterCodeFA12" | "#dexterCodeFA2"
  syntax Data ::= #dexterCode ( Bool ) [function, functional]

  rule #dexterCode(IsFA2) => #dexterCodeFA2  requires         IsFA2
  rule #dexterCode(IsFA2) => #dexterCodeFA12 requires notBool IsFA2
```

## Annotations

Annotations are arbitrary tokens.
The set of permissible annotations is infinite.
Since we work with specific code that contains a finite number of annotations, we can represent each and give it a macro for wrapping it in the `#token(...)` production.

```k
  syntax Annotation ::= "%balance_of"
                      | "%deadline"
                      | "%getBalance"
                      | "%minTokensBought"
                      | "%mintOrBurn"
                      | "%quantity"
                      | "%target"
                      | "%to"
                      | "%transfer"
                      | "%updateTokenPoolInternal"
                      | "%xtzToToken"

  rule %balance_of              => #token("%balance_of"             , "FieldAnnotation") [macro]
  rule %deadline                => #token("%deadline"               , "FieldAnnotation") [macro]
  rule %getBalance              => #token("%getBalance"             , "FieldAnnotation") [macro]
  rule %minTokensBought         => #token("%minTokensBought"        , "FieldAnnotation") [macro]
  rule %mintOrBurn              => #token("%mintOrBurn"             , "FieldAnnotation") [macro]
  rule %quantity                => #token("%quantity"               , "FieldAnnotation") [macro]
  rule %target                  => #token("%target"                 , "FieldAnnotation") [macro]
  rule %to                      => #token("%to"                     , "FieldAnnotation") [macro]
  rule %transfer                => #token("%transfer"               , "FieldAnnotation") [macro]
  rule %updateTokenPoolInternal => #token("%updateTokenPoolInternal", "FieldAnnotation") [macro]
  rule %xtzToToken              => #token("%xtzToToken"             , "FieldAnnotation") [macro]
```

## FA1.2

```k
  rule #dexterCodeFA12
    => { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           // Left
           { IF_LEFT
               // Left Left
               { IF_LEFT
                   // Left Left Left
                   { IF_LEFT
                       // Left Left Left Left
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 5 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 4 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 1 ;
                                   DIG 4 ;
                                   DUP ;
                                   DUG 5 ;
                                   CDR ;
                                   CAR ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   AMOUNT ;
                                   PUSH mutez 1 ;
                                   SWAP ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   MUL ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   DIG 2 ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   CAR ;
                                   DIG 3 ;
                                   MUL ;
                                   EDIV ;
                                   IF_NONE
                                     { PUSH string "DIV by 0" ; FAILWITH }
                                     { DUP ;
                                       CDR ;
                                       SWAP ;
                                       CAR ;
                                       PUSH nat 0 ;
                                       DIG 2 ;
                                       COMPARE ;
                                       EQ ;
                                       IF {} { PUSH nat 1 ; ADD } } ;
                                   DIG 2 ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 5 ; PUSH nat 4 ; FAILWITH }
                                      { DUG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP 4 ; PUSH nat 5 ; FAILWITH }
                                           { DIG 3 ;
                                             DUP ;
                                             DUG 4 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             DIG 5 ;
                                             DUP ;
                                             DUG 6 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CAR ;
                                             PAIR ;
                                             CDR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             DIG 5 ;
                                             DUP ;
                                             DUG 6 ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             DUP ;
                                             CDR ;
                                             CDR ;
                                             AMOUNT ;
                                             DIG 6 ;
                                             CDR ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             SWAP ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             SELF ;
                                             ADDRESS ;
                                             PAIR ;
                                             SENDER ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             DIG 3 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             CONTRACT %transfer (pair address (pair address nat)) ;
                                             IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                             PUSH mutez 0 ;
                                             DIG 3 ;
                                             DIG 3 ;
                                             PAIR ;
                                             DIG 3 ;
                                             PAIR ;
                                             TRANSFER_TOKENS ;
                                             DIG 2 ;
                                             INT ;
                                             DIG 3 ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             DIG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CONTRACT %mintOrBurn (pair (int %quantity) (address %target)) ;
                                             IF_NONE { PUSH nat 12 ; FAILWITH } {} ;
                                             PUSH mutez 0 ;
                                             DIG 2 ;
                                             DIG 3 ;
                                             PAIR ;
                                             TRANSFER_TOKENS ;
                                             DIG 2 ;
                                             NIL operation ;
                                             DIG 2 ;
                                             CONS ;
                                             DIG 2 ;
                                             CONS ;
                                             PAIR } } } } }
                       // Left Left Left Right
                       { DROP ;
                         DUP ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP ; PUSH nat 2 ; FAILWITH }
                            { DUP ;
                              CDR ;
                              CDR ;
                              AMOUNT ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              CDR ;
                              CAR ;
                              ADD ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR ;
                              NIL operation ;
                              PAIR } } }
                   // Left Left Right
                   { IF_LEFT
                       // Left Left Right Left
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 6 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 5 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 0 ;
                                   AMOUNT ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 5 ; PUSH nat 10 ; FAILWITH }
                                      { DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CAR ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        DIG 3 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP 6 ; PUSH nat 11 ; FAILWITH }
                                           { DIG 2 ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             COMPARE ;
                                             LT ;
                                             IF { DROP 5 ; PUSH nat 13 ; FAILWITH }
                                                { DIG 2 ;
                                                  DUP ;
                                                  DUG 3 ;
                                                  DIG 5 ;
                                                  DUP ;
                                                  DUG 6 ;
                                                  CDR ;
                                                  CDR ;
                                                  CAR ;
                                                  SUB ;
                                                  ISNAT ;
                                                  IF_NONE { PUSH nat 14 ; FAILWITH } {} ;
                                                  SWAP ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  CAR ;
                                                  SUB ;
                                                  ISNAT ;
                                                  IF_NONE { PUSH nat 15 ; FAILWITH } {} ;
                                                  DIG 4 ;
                                                  PUSH int 0 ;
                                                  SUB ;
                                                  SENDER ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  DIG 2 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CONTRACT %mintOrBurn (pair (int %quantity) (address %target)) ;
                                                  IF_NONE { PUSH nat 12 ; FAILWITH } {} ;
                                                  PUSH mutez 0 ;
                                                  DIG 2 ;
                                                  DIG 3 ;
                                                  PAIR ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 3 ;
                                                  DIG 5 ;
                                                  DUP ;
                                                  DUG 6 ;
                                                  PAIR ;
                                                  SELF ;
                                                  ADDRESS ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  DIG 3 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CAR ;
                                                  CONTRACT %transfer (pair address (pair address nat)) ;
                                                  IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                                  PUSH mutez 0 ;
                                                  DIG 3 ;
                                                  DIG 3 ;
                                                  PAIR ;
                                                  DIG 3 ;
                                                  PAIR ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 4 ;
                                                  DUP ;
                                                  DUG 5 ;
                                                  DIG 6 ;
                                                  CONTRACT unit ;
                                                  IF_NONE { PUSH nat 9 ; FAILWITH } {} ;
                                                  SWAP ;
                                                  PUSH unit Unit ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  CDR ;
                                                  CDR ;
                                                  DIG 6 ;
                                                  DIG 7 ;
                                                  DUP ;
                                                  DUG 8 ;
                                                  CDR ;
                                                  CAR ;
                                                  SUB ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  CAR ;
                                                  PAIR ;
                                                  DUP ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  DIG 6 ;
                                                  PAIR ;
                                                  SWAP ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  CDR ;
                                                  CAR ;
                                                  PAIR ;
                                                  SWAP ;
                                                  CAR ;
                                                  PAIR ;
                                                  CDR ;
                                                  DIG 4 ;
                                                  PAIR ;
                                                  NIL operation ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  PAIR } } } } } }
                       // Left Left Right Right
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 3 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 3 ; PUSH nat 10 ; FAILWITH }
                                 { DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 3 ; PUSH nat 20 ; FAILWITH }
                                      { DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        IF { DROP 3 ; PUSH nat 22 ; FAILWITH }
                                           { DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             DIG 2 ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             CAR ;
                                             PAIR ;
                                             NIL operation ;
                                             DIG 2 ;
                                             SET_DELEGATE ;
                                             CONS ;
                                             PAIR } } } } } } }
               // Left Right
               { IF_LEFT
                   // Left Right Left
                   { IF_LEFT
                       // Left Right Left Left
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 2 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 2 ; PUSH nat 23 ; FAILWITH }
                                      { PUSH address "tz1Ke2h7sDdakHJQh8WX4Z372du1KChsksyU" ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        COMPARE ;
                                        NEQ ;
                                        IF { DROP 2 ; PUSH nat 24 ; FAILWITH }
                                           { SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             CAR ;
                                             PAIR ;
                                             NIL operation ;
                                             PAIR } } } } }
                       // Left Right Left Right
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 2 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 2 ; PUSH nat 21 ; FAILWITH }
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        NIL operation ;
                                        PAIR } } } } }
                   // Left Right Right
                   { IF_LEFT
                       // Left Right Right Left
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         CONTRACT %xtzToToken
                           (pair (address %to) (pair (nat %minTokensBought) (timestamp %deadline))) ;
                         IF_NONE { PUSH nat 31 ; FAILWITH } {} ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 6 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 6 ; PUSH nat 10 ; FAILWITH }
                                 { DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   NOW ;
                                   COMPARE ;
                                   GE ;
                                   IF { DROP 6 ; PUSH nat 3 ; FAILWITH }
                                      { PUSH nat 997 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        MUL ;
                                        PUSH nat 1000 ;
                                        DIG 7 ;
                                        DUP ;
                                        DUG 8 ;
                                        CAR ;
                                        MUL ;
                                        ADD ;
                                        PUSH mutez 1 ;
                                        DIG 7 ;
                                        DUP ;
                                        DUG 8 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH nat 997 ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CDR ;
                                        DIG 3 ;
                                        DUP ;
                                        DUG 4 ;
                                        DIG 8 ;
                                        DUP ;
                                        DUG 9 ;
                                        CAR ;
                                        ADD ;
                                        PAIR ;
                                        DUP ;
                                        CDR ;
                                        CDR ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        DIG 9 ;
                                        CDR ;
                                        CAR ;
                                        SUB ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        DIG 3 ;
                                        SELF ;
                                        ADDRESS ;
                                        PAIR ;
                                        SENDER ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        DIG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        CONTRACT %transfer (pair address (pair address nat)) ;
                                        IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                        PUSH mutez 0 ;
                                        DIG 3 ;
                                        DIG 3 ;
                                        PAIR ;
                                        DIG 3 ;
                                        PAIR ;
                                        TRANSFER_TOKENS ;
                                        DIG 3 ;
                                        DIG 3 ;
                                        DIG 4 ;
                                        DIG 6 ;
                                        PAIR ;
                                        DIG 5 ;
                                        PAIR ;
                                        TRANSFER_TOKENS ;
                                        DIG 2 ;
                                        NIL operation ;
                                        DIG 2 ;
                                        CONS ;
                                        DIG 2 ;
                                        CONS ;
                                        PAIR } } } }
                       // Left Right Right Right
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 5 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 4 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 0 ;
                                   AMOUNT ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 4 ; PUSH nat 10 ; FAILWITH }
                                      { PUSH nat 997 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        MUL ;
                                        PUSH nat 1000 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CAR ;
                                        MUL ;
                                        ADD ;
                                        PUSH mutez 1 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH nat 997 ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DUP ;
                                        DUG 2 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP ; PUSH nat 8 ; FAILWITH } {} ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        SELF ;
                                        ADDRESS ;
                                        PAIR ;
                                        SENDER ;
                                        PAIR ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        DIG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        CONTRACT %transfer (pair address (pair address nat)) ;
                                        IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                        PUSH mutez 0 ;
                                        DIG 3 ;
                                        DIG 3 ;
                                        PAIR ;
                                        DIG 3 ;
                                        PAIR ;
                                        TRANSFER_TOKENS ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        DIG 4 ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH nat 9 ; FAILWITH } {} ;
                                        SWAP ;
                                        PUSH unit Unit ;
                                        TRANSFER_TOKENS ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        CDR ;
                                        DIG 4 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CAR ;
                                        ADD ;
                                        PAIR ;
                                        DUP ;
                                        CDR ;
                                        CDR ;
                                        DIG 4 ;
                                        DIG 5 ;
                                        CDR ;
                                        CAR ;
                                        SUB ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        NIL operation ;
                                        DIG 2 ;
                                        CONS ;
                                        DIG 2 ;
                                        CONS ;
                                        PAIR } } } } } } }
           // Right
           { IF_LEFT
               // Right Left
               { IF_LEFT
                   // Right Left Left
                   { DROP ;
                     SOURCE ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { DROP ; PUSH nat 25 ; FAILWITH }
                        { PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { DROP ; PUSH nat 10 ; FAILWITH }
                             { DUP ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               IF { DROP ; PUSH nat 33 ; FAILWITH }
                                  { SELF %updateTokenPoolInternal ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    CONTRACT %getBalance (pair address (contract nat)) ;
                                    IF_NONE { PUSH nat 28 ; FAILWITH } {} ;
                                    PUSH mutez 0 ;
                                    DIG 2 ;
                                    SELF ;
                                    ADDRESS ;
                                    PAIR ;
                                    TRANSFER_TOKENS ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    PUSH bool True ;
                                    PAIR ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    PAIR ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    CDR ;
                                    CAR ;
                                    PAIR ;
                                    DIG 2 ;
                                    CAR ;
                                    PAIR ;
                                    NIL operation ;
                                    DIG 2 ;
                                    CONS ;
                                    PAIR } } } }
                   // Right Left Right
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     NOT ;
                     OR ;
                     IF { DROP 2 ; PUSH nat 29 ; FAILWITH }
                        { PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                             { SWAP ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               DUP ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               PUSH bool False ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               CAR ;
                               PAIR ;
                               NIL operation ;
                               PAIR } } } }
               // Right Right
               { DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CDR ;
                 CDR ;
                 CDR ;
                 CAR ;
                 IF { DROP 4 ; PUSH nat 2 ; FAILWITH }
                    { SWAP ;
                      NOW ;
                      COMPARE ;
                      GE ;
                      IF { DROP 3 ; PUSH nat 3 ; FAILWITH }
                         { PUSH mutez 1 ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           CAR ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           AMOUNT ;
                           PUSH mutez 1 ;
                           SWAP ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           PUSH nat 997 ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           MUL ;
                           PUSH nat 1000 ;
                           DIG 3 ;
                           MUL ;
                           ADD ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           CAR ;
                           PUSH nat 997 ;
                           DIG 3 ;
                           MUL ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           DUP ;
                           DUG 2 ;
                           COMPARE ;
                           LT ;
                           IF { DROP ; PUSH nat 18 ; FAILWITH } {} ;
                           DUP ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CAR ;
                           SUB ;
                           ISNAT ;
                           IF_NONE { PUSH nat 19 ; FAILWITH } {} ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           CDR ;
                           AMOUNT ;
                           DIG 5 ;
                           DUP ;
                           DUG 6 ;
                           CDR ;
                           CAR ;
                           ADD ;
                           PAIR ;
                           DIG 4 ;
                           CAR ;
                           PAIR ;
                           CDR ;
                           SWAP ;
                           PAIR ;
                           SWAP ;
                           DIG 2 ;
                           PAIR ;
                           SELF ;
                           ADDRESS ;
                           PAIR ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           SWAP ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           SWAP ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           DIG 3 ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CAR ;
                           CONTRACT %transfer (pair address (pair address nat)) ;
                           IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                           PUSH mutez 0 ;
                           DIG 3 ;
                           DIG 3 ;
                           PAIR ;
                           DIG 3 ;
                           PAIR ;
                           TRANSFER_TOKENS ;
                           SWAP ;
                           NIL operation ;
                           DIG 2 ;
                           CONS ;
                           PAIR } } } } }
       [macro]
```

## FA2

```k
  rule #dexterCodeFA2
    => { DUP ;
         CDR ;
         SWAP ;
         CAR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 5 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 4 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 1 ;
                                   DIG 4 ;
                                   DUP ;
                                   DUG 5 ;
                                   CDR ;
                                   CAR ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   AMOUNT ;
                                   PUSH mutez 1 ;
                                   SWAP ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   MUL ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   DIG 2 ;
                                   DIG 6 ;
                                   DUP ;
                                   DUG 7 ;
                                   CAR ;
                                   DIG 3 ;
                                   MUL ;
                                   EDIV ;
                                   IF_NONE
                                     { PUSH string "DIV by 0" ; FAILWITH }
                                     { DUP ;
                                       CDR ;
                                       SWAP ;
                                       CAR ;
                                       PUSH nat 0 ;
                                       DIG 2 ;
                                       COMPARE ;
                                       EQ ;
                                       IF {} { PUSH nat 1 ; ADD } } ;
                                   DIG 2 ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 5 ; PUSH nat 4 ; FAILWITH }
                                      { DUG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP 4 ; PUSH nat 5 ; FAILWITH }
                                           { DIG 3 ;
                                             DUP ;
                                             DUG 4 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             DIG 5 ;
                                             DUP ;
                                             DUG 6 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             CAR ;
                                             PAIR ;
                                             CDR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             DIG 5 ;
                                             DUP ;
                                             DUG 6 ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             DUP ;
                                             CDR ;
                                             CDR ;
                                             AMOUNT ;
                                             DIG 6 ;
                                             CDR ;
                                             CAR ;
                                             ADD ;
                                             PAIR ;
                                             SWAP ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             SELF ;
                                             ADDRESS ;
                                             PAIR ;
                                             SENDER ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             DIG 3 ;
                                             DUP ;
                                             DUG 4 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                                             IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                             PUSH mutez 0 ;
                                             NIL (pair address (list (pair address (pair nat nat)))) ;
                                             NIL (pair address (pair nat nat)) ;
                                             DIG 5 ;
                                             DIG 7 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 5 ;
                                             PAIR ;
                                             CONS ;
                                             DIG 4 ;
                                             PAIR ;
                                             CONS ;
                                             TRANSFER_TOKENS ;
                                             DIG 2 ;
                                             INT ;
                                             DIG 3 ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             SWAP ;
                                             DUP ;
                                             CDR ;
                                             SWAP ;
                                             CAR ;
                                             DIG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CONTRACT %mintOrBurn (pair (int %quantity) (address %target)) ;
                                             IF_NONE { PUSH nat 12 ; FAILWITH } {} ;
                                             PUSH mutez 0 ;
                                             DIG 2 ;
                                             DIG 3 ;
                                             PAIR ;
                                             TRANSFER_TOKENS ;
                                             DIG 2 ;
                                             NIL operation ;
                                             DIG 2 ;
                                             CONS ;
                                             DIG 2 ;
                                             CONS ;
                                             PAIR } } } } }
                       { DROP ;
                         DUP ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP ; PUSH nat 2 ; FAILWITH }
                            { DUP ;
                              CDR ;
                              CDR ;
                              AMOUNT ;
                              DIG 2 ;
                              DUP ;
                              DUG 3 ;
                              CDR ;
                              CAR ;
                              ADD ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR ;
                              NIL operation ;
                              PAIR } } }
                   { IF_LEFT
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 6 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 5 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 0 ;
                                   AMOUNT ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 5 ; PUSH nat 10 ; FAILWITH }
                                      { DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CAR ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        DIG 3 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP 6 ; PUSH nat 11 ; FAILWITH }
                                           { DIG 2 ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             COMPARE ;
                                             LT ;
                                             IF { DROP 5 ; PUSH nat 13 ; FAILWITH }
                                                { DIG 2 ;
                                                  DUP ;
                                                  DUG 3 ;
                                                  DIG 5 ;
                                                  DUP ;
                                                  DUG 6 ;
                                                  CDR ;
                                                  CDR ;
                                                  CAR ;
                                                  SUB ;
                                                  ISNAT ;
                                                  IF_NONE { PUSH nat 14 ; FAILWITH } {} ;
                                                  SWAP ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  CAR ;
                                                  SUB ;
                                                  ISNAT ;
                                                  IF_NONE { PUSH nat 15 ; FAILWITH } {} ;
                                                  DIG 4 ;
                                                  PUSH int 0 ;
                                                  SUB ;
                                                  SENDER ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  DIG 2 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CONTRACT %mintOrBurn (pair (int %quantity) (address %target)) ;
                                                  IF_NONE { PUSH nat 12 ; FAILWITH } {} ;
                                                  PUSH mutez 0 ;
                                                  DIG 2 ;
                                                  DIG 3 ;
                                                  PAIR ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 3 ;
                                                  DIG 5 ;
                                                  DUP ;
                                                  DUG 6 ;
                                                  PAIR ;
                                                  SELF ;
                                                  ADDRESS ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  SWAP ;
                                                  DUP ;
                                                  CDR ;
                                                  SWAP ;
                                                  CAR ;
                                                  DIG 3 ;
                                                  DUP ;
                                                  DUG 4 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CAR ;
                                                  CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                                                  IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                                  PUSH mutez 0 ;
                                                  NIL (pair address (list (pair address (pair nat nat)))) ;
                                                  NIL (pair address (pair nat nat)) ;
                                                  DIG 5 ;
                                                  DIG 7 ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  CAR ;
                                                  PAIR ;
                                                  DIG 5 ;
                                                  PAIR ;
                                                  CONS ;
                                                  DIG 4 ;
                                                  PAIR ;
                                                  CONS ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 4 ;
                                                  DUP ;
                                                  DUG 5 ;
                                                  DIG 6 ;
                                                  CONTRACT unit ;
                                                  IF_NONE { PUSH nat 9 ; FAILWITH } {} ;
                                                  SWAP ;
                                                  PUSH unit Unit ;
                                                  TRANSFER_TOKENS ;
                                                  DIG 6 ;
                                                  DUP ;
                                                  DUG 7 ;
                                                  CDR ;
                                                  CDR ;
                                                  DIG 6 ;
                                                  DIG 7 ;
                                                  DUP ;
                                                  DUG 8 ;
                                                  CDR ;
                                                  CAR ;
                                                  SUB ;
                                                  PAIR ;
                                                  DIG 6 ;
                                                  CAR ;
                                                  PAIR ;
                                                  DUP ;
                                                  CDR ;
                                                  CDR ;
                                                  CDR ;
                                                  DIG 6 ;
                                                  PAIR ;
                                                  SWAP ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  CDR ;
                                                  CAR ;
                                                  PAIR ;
                                                  SWAP ;
                                                  CAR ;
                                                  PAIR ;
                                                  CDR ;
                                                  DIG 4 ;
                                                  PAIR ;
                                                  NIL operation ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  DIG 2 ;
                                                  CONS ;
                                                  PAIR } } } } } }
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 3 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 3 ; PUSH nat 10 ; FAILWITH }
                                 { DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 3 ; PUSH nat 20 ; FAILWITH }
                                      { DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        IF { DROP 3 ; PUSH nat 22 ; FAILWITH }
                                           { DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             DIG 2 ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             DIG 2 ;
                                             CAR ;
                                             PAIR ;
                                             NIL operation ;
                                             DIG 2 ;
                                             SET_DELEGATE ;
                                             CONS ;
                                             PAIR } } } } } } }
               { IF_LEFT
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 2 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 2 ; PUSH nat 23 ; FAILWITH }
                                      { PUSH address "tz1Ke2h7sDdakHJQh8WX4Z372du1KChsksyU" ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        COMPARE ;
                                        NEQ ;
                                        IF { DROP 2 ; PUSH nat 24 ; FAILWITH }
                                           { SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             DUP ;
                                             DUG 2 ;
                                             CDR ;
                                             CAR ;
                                             PAIR ;
                                             SWAP ;
                                             CAR ;
                                             PAIR ;
                                             NIL operation ;
                                             PAIR } } } } }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 2 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SENDER ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DROP 2 ; PUSH nat 21 ; FAILWITH }
                                      { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        SWAP ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        NIL operation ;
                                        PAIR } } } } }
                   { IF_LEFT
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         CONTRACT %xtzToToken
                           (pair (address %to) (pair (nat %minTokensBought) (timestamp %deadline))) ;
                         IF_NONE { PUSH nat 31 ; FAILWITH } {} ;
                         DIG 5 ;
                         DUP ;
                         DUG 6 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 6 ; PUSH nat 2 ; FAILWITH }
                            { PUSH mutez 0 ;
                              AMOUNT ;
                              COMPARE ;
                              GT ;
                              IF { DROP 6 ; PUSH nat 10 ; FAILWITH }
                                 { DIG 2 ;
                                   DUP ;
                                   DUG 3 ;
                                   NOW ;
                                   COMPARE ;
                                   GE ;
                                   IF { DROP 6 ; PUSH nat 3 ; FAILWITH }
                                      { PUSH nat 997 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        MUL ;
                                        PUSH nat 1000 ;
                                        DIG 7 ;
                                        DUP ;
                                        DUG 8 ;
                                        CAR ;
                                        MUL ;
                                        ADD ;
                                        PUSH mutez 1 ;
                                        DIG 7 ;
                                        DUP ;
                                        DUG 8 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH nat 997 ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DIG 6 ;
                                        DUP ;
                                        DUG 7 ;
                                        CDR ;
                                        DIG 3 ;
                                        DUP ;
                                        DUG 4 ;
                                        DIG 8 ;
                                        DUP ;
                                        DUG 9 ;
                                        CAR ;
                                        ADD ;
                                        PAIR ;
                                        DUP ;
                                        CDR ;
                                        CDR ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        DIG 9 ;
                                        CDR ;
                                        CAR ;
                                        SUB ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        DIG 3 ;
                                        SELF ;
                                        ADDRESS ;
                                        PAIR ;
                                        SENDER ;
                                        PAIR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        DIG 3 ;
                                        DUP ;
                                        DUG 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                                        IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                        PUSH mutez 0 ;
                                        NIL (pair address (list (pair address (pair nat nat)))) ;
                                        NIL (pair address (pair nat nat)) ;
                                        DIG 5 ;
                                        DIG 7 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DIG 5 ;
                                        PAIR ;
                                        CONS ;
                                        DIG 4 ;
                                        PAIR ;
                                        CONS ;
                                        TRANSFER_TOKENS ;
                                        DIG 3 ;
                                        DIG 3 ;
                                        DIG 4 ;
                                        DIG 6 ;
                                        PAIR ;
                                        DIG 5 ;
                                        PAIR ;
                                        TRANSFER_TOKENS ;
                                        DIG 2 ;
                                        NIL operation ;
                                        DIG 2 ;
                                        CONS ;
                                        DIG 2 ;
                                        CONS ;
                                        PAIR } } } }
                       { DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         DUP ;
                         DUG 5 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { DROP 5 ; PUSH nat 2 ; FAILWITH }
                            { SWAP ;
                              NOW ;
                              COMPARE ;
                              GE ;
                              IF { DROP 4 ; PUSH nat 3 ; FAILWITH }
                                 { PUSH mutez 0 ;
                                   AMOUNT ;
                                   COMPARE ;
                                   GT ;
                                   IF { DROP 4 ; PUSH nat 10 ; FAILWITH }
                                      { PUSH nat 997 ;
                                        DIG 2 ;
                                        DUP ;
                                        DUG 3 ;
                                        MUL ;
                                        PUSH nat 1000 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CAR ;
                                        MUL ;
                                        ADD ;
                                        PUSH mutez 1 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CDR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH nat 997 ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        MUL ;
                                        MUL ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH mutez 1 ;
                                        SWAP ;
                                        MUL ;
                                        DUP ;
                                        DUG 2 ;
                                        COMPARE ;
                                        LT ;
                                        IF { DROP ; PUSH nat 8 ; FAILWITH } {} ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        SELF ;
                                        ADDRESS ;
                                        PAIR ;
                                        SENDER ;
                                        PAIR ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        SWAP ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        CAR ;
                                        DIG 3 ;
                                        DUP ;
                                        DUG 4 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                                        IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                                        PUSH mutez 0 ;
                                        NIL (pair address (list (pair address (pair nat nat)))) ;
                                        NIL (pair address (pair nat nat)) ;
                                        DIG 5 ;
                                        DIG 7 ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DIG 5 ;
                                        PAIR ;
                                        CONS ;
                                        DIG 4 ;
                                        PAIR ;
                                        CONS ;
                                        TRANSFER_TOKENS ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        DIG 4 ;
                                        CONTRACT unit ;
                                        IF_NONE { PUSH nat 9 ; FAILWITH } {} ;
                                        SWAP ;
                                        PUSH unit Unit ;
                                        TRANSFER_TOKENS ;
                                        DIG 4 ;
                                        DUP ;
                                        DUG 5 ;
                                        CDR ;
                                        DIG 4 ;
                                        DIG 5 ;
                                        DUP ;
                                        DUG 6 ;
                                        CAR ;
                                        ADD ;
                                        PAIR ;
                                        DUP ;
                                        CDR ;
                                        CDR ;
                                        DIG 4 ;
                                        DIG 5 ;
                                        CDR ;
                                        CAR ;
                                        SUB ;
                                        PAIR ;
                                        SWAP ;
                                        CAR ;
                                        PAIR ;
                                        NIL operation ;
                                        DIG 2 ;
                                        CONS ;
                                        DIG 2 ;
                                        CONS ;
                                        PAIR } } } } } } }
           { IF_LEFT
               { IF_LEFT
                   { DROP ;
                     SOURCE ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { DROP ; PUSH nat 25 ; FAILWITH }
                        { PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { DROP ; PUSH nat 10 ; FAILWITH }
                             { DUP ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CAR ;
                               IF { DROP ; PUSH nat 33 ; FAILWITH }
                                  { SELF %updateTokenPoolInternal ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    CONTRACT %balance_of
                                      (pair (list (pair address nat)) (contract (list (pair (pair address nat) nat)))) ;
                                    IF_NONE { PUSH nat 28 ; FAILWITH } {} ;
                                    PUSH mutez 0 ;
                                    DIG 2 ;
                                    NIL (pair address nat) ;
                                    DIG 4 ;
                                    DUP ;
                                    DUG 5 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    SELF ;
                                    ADDRESS ;
                                    PAIR ;
                                    CONS ;
                                    PAIR ;
                                    TRANSFER_TOKENS ;
                                    SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    PUSH bool True ;
                                    PAIR ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    PAIR ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    CDR ;
                                    CAR ;
                                    PAIR ;
                                    DIG 2 ;
                                    CAR ;
                                    PAIR ;
                                    NIL operation ;
                                    DIG 2 ;
                                    CONS ;
                                    PAIR } } } }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     DIG 2 ;
                     DUP ;
                     DUG 3 ;
                     CDR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     NOT ;
                     OR ;
                     IF { DROP 2 ; PUSH nat 29 ; FAILWITH }
                        { PUSH mutez 0 ;
                          AMOUNT ;
                          COMPARE ;
                          GT ;
                          IF { DROP 2 ; PUSH nat 10 ; FAILWITH }
                             { IF_CONS { SWAP ; DROP ; CDR } { PUSH nat 32 ; FAILWITH } ;
                               SWAP ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               DUP ;
                               CDR ;
                               CDR ;
                               CDR ;
                               CDR ;
                               PUSH bool False ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CAR ;
                               PAIR ;
                               SWAP ;
                               CAR ;
                               PAIR ;
                               NIL operation ;
                               PAIR } } } }
               { DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 SWAP ;
                 DUP ;
                 CDR ;
                 SWAP ;
                 CAR ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 CDR ;
                 CDR ;
                 CDR ;
                 CAR ;
                 IF { DROP 4 ; PUSH nat 2 ; FAILWITH }
                    { SWAP ;
                      NOW ;
                      COMPARE ;
                      GE ;
                      IF { DROP 3 ; PUSH nat 3 ; FAILWITH }
                         { PUSH mutez 1 ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           CAR ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           AMOUNT ;
                           PUSH mutez 1 ;
                           SWAP ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           PUSH nat 997 ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           MUL ;
                           PUSH nat 1000 ;
                           DIG 3 ;
                           MUL ;
                           ADD ;
                           DIG 4 ;
                           DUP ;
                           DUG 5 ;
                           CAR ;
                           PUSH nat 997 ;
                           DIG 3 ;
                           MUL ;
                           MUL ;
                           EDIV ;
                           IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                           CAR ;
                           DUP ;
                           DUG 2 ;
                           COMPARE ;
                           LT ;
                           IF { DROP ; PUSH nat 18 ; FAILWITH } {} ;
                           DUP ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CAR ;
                           SUB ;
                           ISNAT ;
                           IF_NONE { PUSH nat 19 ; FAILWITH } {} ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           CDR ;
                           AMOUNT ;
                           DIG 5 ;
                           DUP ;
                           DUG 6 ;
                           CDR ;
                           CAR ;
                           ADD ;
                           PAIR ;
                           DIG 4 ;
                           CAR ;
                           PAIR ;
                           CDR ;
                           SWAP ;
                           PAIR ;
                           SWAP ;
                           DIG 2 ;
                           PAIR ;
                           SELF ;
                           ADDRESS ;
                           PAIR ;
                           SWAP ;
                           DUP ;
                           DUG 2 ;
                           SWAP ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           SWAP ;
                           DUP ;
                           CDR ;
                           SWAP ;
                           CAR ;
                           DIG 3 ;
                           DUP ;
                           DUG 4 ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CAR ;
                           CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                           IF_NONE { PUSH nat 0 ; FAILWITH } {} ;
                           PUSH mutez 0 ;
                           NIL (pair address (list (pair address (pair nat nat)))) ;
                           NIL (pair address (pair nat nat)) ;
                           DIG 5 ;
                           DIG 7 ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CDR ;
                           CAR ;
                           PAIR ;
                           DIG 5 ;
                           PAIR ;
                           CONS ;
                           DIG 4 ;
                           PAIR ;
                           CONS ;
                           TRANSFER_TOKENS ;
                           SWAP ;
                           NIL operation ;
                           DIG 2 ;
                           CONS ;
                           PAIR } } } } }
       [macro]
```

```k
endmodule
```
