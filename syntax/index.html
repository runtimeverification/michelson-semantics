<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="A Michelson semantics for Tezos built using the K Framework."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="Michelson Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<!-- <link rel="icon" type="image/png" href="../assets/img/favicon.ico" /> -->

<title>Michelson Semantics | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../index.html"> Michelson Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/michelson-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../">Homepage</a>
      <a class="bd-toc-link" href="../INSTALL">Install</a>
      <a class="bd-toc-link" href="../USER_GUIDE">User Guide</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="michelson-syntax">Michelson Syntax</h1>
<p>This module declares the syntax of a K-Michelson input file. In particular, it
contains the syntax of a Michelson contract and the additional data necessary
to fully specify a contract execution.</p>
<h2 id="michelson-parser-syntax">Michelson Parser Syntax</h2>
<p>This module defines the core parser of Michelson programs.
Unit test file syntax is defined as a slight extension of this file.</p>
<pre class="language-k"><code><span class="token keyword">module</span> MICHELSON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX

  <span class="token keyword">syntax</span> MichelsonBoolToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;True&quot;</span>  <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
                              <span class="token operator">|</span> <span class="token string">&quot;False&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> MichelsonBytesToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;0x([0-9a-fA-F]{2})*&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> Groups <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Group <span class="token string">&quot;;&quot;</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>groupSemicolon<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> TypeAnnotation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;:([_a-zA-Z][_0-9a-zA-Z\\.]*)?&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> VariableAnnotation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;@(%|%%|[_a-zA-Z][_0-9a-zA-Z\\.]*)?&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> FieldAnnotation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;%(@|[_a-zA-Z][_0-9a-zA-Z\\.]*)?&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> Wildcard <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;_&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>

  <span class="token comment">// NB: This special token defines the syntax to be ignored by the parser</span>
  <span class="token keyword">syntax</span> #Layout <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;(#.*)|[\\n \\t\\r]*&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
<h2 id="michelson-common-syntax">Michelson Common Syntax</h2>
<p>Common syntax is shared between the parser and the internal semantic
representation.</p>
<pre class="language-k"><code><span class="token keyword">module</span> MICHELSON<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> INT<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> STRING<span class="token operator">-</span>SYNTAX
</code></pre>
<h3 id="type-syntax">Type Syntax</h3>
<p>Type annotations only exist as tokens in the internal representation.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> TypeAnnotation <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> VariableAnnotation <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> FieldAnnotation <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Annotation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypeAnnotation <span class="token operator">|</span> VariableAnnotation <span class="token operator">|</span> FieldAnnotation

  <span class="token keyword">syntax</span> AnnotationList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>Annotation<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
</code></pre>
<p>Types are defined as expected.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> NumTypeName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;int&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;nat&quot;</span>

  <span class="token keyword">syntax</span> NullaryTypeName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> NumTypeName
                           <span class="token operator">|</span> <span class="token string">&quot;string&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;bytes&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;mutez&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;bool&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;key_hash&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;timestamp&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;address&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;key&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;unit&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;signature&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;operation&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;chain_id&quot;</span>

  <span class="token keyword">syntax</span> UnaryTypeName   <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;option&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;list&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;set&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;contract&quot;</span>

  <span class="token keyword">syntax</span> MapTypeName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;map&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;big_map&quot;</span>

  <span class="token keyword">syntax</span> BinaryTypeName  <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;pair&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;or&quot;</span>
                           <span class="token operator">|</span> <span class="token string">&quot;lambda&quot;</span>
                           <span class="token operator">|</span> MapTypeName

  <span class="token keyword">syntax</span> Type <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> NullaryTypeName AnnotationList
                <span class="token operator">|</span> UnaryTypeName   AnnotationList Type
                <span class="token operator">|</span> BinaryTypeName  AnnotationList Type Type
</code></pre>
<h3 id="data-literal-syntax">Data Literal Syntax</h3>
<p>Simple data literals have efficiently detectable normal forms at runtime.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">String</span>
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MichelsonBool
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MichelsonBytes
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Unit&quot;</span>
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Mutez
  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Address
  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> SimpleData

  <span class="token keyword">syntax</span> Address
  <span class="token keyword">syntax</span> Mutez
</code></pre>
<p>This declaration instructs the compiler to consider SimpleData literals to be
in normal form.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> KResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> SimpleData
</code></pre>
<p>At parse time, <code>mutez</code> and <code>address</code> literals are read in as ints and strings.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> MutezLiteral   <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> AddressLiteral <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">String</span>
</code></pre>
<p><code>bytes</code> and <code>bool</code> literals must be converted from Michelson to K syntax.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> MichelsonBytesToken <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> MichelsonBytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MichelsonBytesToken <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>MichelsonBytesToken<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token class-name">avoid</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> MichelsonBoolToken <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> MichelsonBool <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MichelsonBoolToken <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>MichelsonBoolToken<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> <span class="token class-name">avoid</span><span class="token punctuation">]</span>
</code></pre>
<p>Simple recursive data structures are defined as expected.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Pair <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Pair&quot;</span> Data Data

  <span class="token keyword">syntax</span> OrData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Left&quot;</span> Data
                  <span class="token operator">|</span> <span class="token string">&quot;Right&quot;</span> Data

  <span class="token keyword">syntax</span> OptionData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Some&quot;</span> Data
                      <span class="token operator">|</span> <span class="token string">&quot;None&quot;</span>

  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Pair <span class="token operator">|</span> OrData <span class="token operator">|</span> OptionData
</code></pre>
<p>Collection sorts (maps, lists, and sets) are defined below.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> EmptyBlock <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> <span class="token string">&quot;}&quot;</span>

  <span class="token keyword">syntax</span> MapEntry <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Elt&quot;</span> Data Data
  <span class="token keyword">syntax</span> MapEntryList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MapEntry <span class="token operator">|</span> MapEntry <span class="token string">&quot;;&quot;</span> MapEntryList
  <span class="token keyword">syntax</span> NeMapLiteral <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> MapEntryList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> MapLiteral <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> NeMapLiteral <span class="token operator">|</span> EmptyBlock
  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MapLiteral

  <span class="token keyword">syntax</span> DataList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Data <span class="token operator">|</span> Data <span class="token string">&quot;;&quot;</span> DataList
  <span class="token keyword">syntax</span> Block <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> DataList <span class="token string">&quot;}&quot;</span> <span class="token operator">|</span> EmptyBlock
  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Block
</code></pre>
<p>The <code>contract</code> literal syntax definition is somewhat redundant due to parser
limitations.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> CodeDecl <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;code&quot;</span> Block
  <span class="token keyword">syntax</span> StorageDecl <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;storage&quot;</span> Type
  <span class="token keyword">syntax</span> ParameterDecl <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;parameter&quot;</span> Type
                         <span class="token operator">|</span> <span class="token string">&quot;parameter&quot;</span> FieldAnnotation Type

  <span class="token keyword">syntax</span> Contract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> CodeDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span>
                    <span class="token operator">|</span> CodeDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span>
                    <span class="token operator">|</span> StorageDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span>
                    <span class="token operator">|</span> ParameterDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span>
                    <span class="token operator">|</span> StorageDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span>
                    <span class="token operator">|</span> ParameterDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span>

  <span class="token keyword">syntax</span> Contract <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> CodeDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span> ParameterDecl
                    <span class="token operator">|</span> CodeDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span> StorageDecl
                    <span class="token operator">|</span> StorageDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span> ParameterDecl
                    <span class="token operator">|</span> ParameterDecl <span class="token string">&quot;;&quot;</span> CodeDecl <span class="token string">&quot;;&quot;</span> StorageDecl
                    <span class="token operator">|</span> StorageDecl <span class="token string">&quot;;&quot;</span> ParameterDecl <span class="token string">&quot;;&quot;</span> CodeDecl
                    <span class="token operator">|</span> ParameterDecl <span class="token string">&quot;;&quot;</span> StorageDecl <span class="token string">&quot;;&quot;</span> CodeDecl
</code></pre>
<h3 id="instruction-syntax">Instruction Syntax</h3>
<p>Note that, because of <code>lambda</code> data literals, instructions are also data.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Instruction
</code></pre>
<p>Most instructions are defined via particular arity, except for blocks, which
are a kind of psuedo-instruction, and special instructions, i.e., instructions
with a unique arity.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Block
                       <span class="token operator">|</span> NullaryInstName AnnotationList
                       <span class="token operator">|</span> UnaryIntInstName AnnotationList <span class="token keyword">Int</span>
                       <span class="token operator">|</span> UnaryTypeInstName AnnotationList Type
                       <span class="token operator">|</span> UnaryBlockInstName AnnotationList Block
                       <span class="token operator">|</span> BinaryTypeInstName AnnotationList Type Type
                       <span class="token operator">|</span> BinaryBlockInstName AnnotationList Block Block
                       <span class="token operator">|</span> SpecialInstruction
</code></pre>
<h4 id="nullary-instructions">Nullary Instructions</h4>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DROP&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DUP&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SWAP&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SOME&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;UNIT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;PAIR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;UNPAIR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CAR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CDR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CONS&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SIZE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;MEM&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;UPDATE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EXEC&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;APPLY&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;FAILWITH&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CAST&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;RENAME&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CONCAT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SLICE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;PACK&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ADD&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SUB&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;MUL&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EDIV&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ABS&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ISNAT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;INT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NEG&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LSL&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LSR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;OR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;AND&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;XOR&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NOT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;COMPARE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EQ&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NEQ&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;GT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;GE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SELF&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;TRANSFER_TOKENS&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SET_DELEGATE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CREATE_ACCOUNT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IMPLICIT_ACCOUNT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NOW&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CHAIN_ID&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;AMOUNT&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;BALANCE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CHECK_SIGNATURE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;BLAKE2B&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SHA256&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SHA512&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;HASH_KEY&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;STEPS_TO_QUOTA&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SOURCE&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SENDER&quot;</span>
  <span class="token keyword">syntax</span> NullaryInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ADDRESS&quot;</span>
</code></pre>
<h4 id="unary-instructions">Unary Instructions</h4>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> UnaryIntInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DROP&quot;</span>
  <span class="token keyword">syntax</span> UnaryIntInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DIG&quot;</span>
  <span class="token keyword">syntax</span> UnaryIntInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DUG&quot;</span>

  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NONE&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LEFT&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;RIGHT&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;NIL&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EMPTY_SET&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;UNPACK&quot;</span>
  <span class="token keyword">syntax</span> UnaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CONTRACT&quot;</span>

  <span class="token keyword">syntax</span> UnaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;MAP&quot;</span>
  <span class="token keyword">syntax</span> UnaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ITER&quot;</span>
  <span class="token keyword">syntax</span> UnaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LOOP&quot;</span>
  <span class="token keyword">syntax</span> UnaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LOOP_LEFT&quot;</span>
  <span class="token keyword">syntax</span> UnaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DIP&quot;</span>
</code></pre>
<h4 id="binary-instructions">Binary Instructions</h4>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> BinaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EMPTY_MAP&quot;</span>
  <span class="token keyword">syntax</span> BinaryTypeInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;EMPTY_BIG_MAP&quot;</span>

  <span class="token keyword">syntax</span> BinaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF_NONE&quot;</span>
  <span class="token keyword">syntax</span> BinaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF_LEFT&quot;</span>
  <span class="token keyword">syntax</span> BinaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF_CONS&quot;</span>
  <span class="token keyword">syntax</span> BinaryBlockInstName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF&quot;</span>
</code></pre>
<h4 id="special-instructions">Special Instructions</h4>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> SpecialInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;PUSH&quot;</span> AnnotationList Type Data
  <span class="token keyword">syntax</span> SpecialInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;LAMBDA&quot;</span> AnnotationList Type Type Block
  <span class="token keyword">syntax</span> SpecialInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CREATE_CONTRACT&quot;</span> AnnotationList <span class="token string">&quot;{&quot;</span> Contract <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> SpecialInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DIP&quot;</span> AnnotationList <span class="token keyword">Int</span> Block
</code></pre>
<h4 id="debugging-instructions">Debugging Instructions</h4>
<p>The following instructions are an extension of the core Michelson instruction
set used for debugging purposes.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;STOP&quot;</span>
  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;PAUSE&quot;</span>
  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> PAUSE<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span>
  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TRACE<span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="macro-syntax">Macro Syntax</h3>
<p>All macros are instructions.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Macro
</code></pre>
<p>Some macros have syntax that can be validated at parse-time. Other macros need
additional runtime processing. The following macros require such processing.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> DIPMacro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;DII+P&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> DUPMacro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;DUU+P&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> CDARMacro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;C[A,D]{2,}R&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> SetCDARMacro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;SET_C[AD]{2,}R&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> MapCDARMacro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;MAP_C[AD]{2,}R&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> NullaryMacroToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> DUPMacro
                             <span class="token operator">|</span> CDARMacro
                             <span class="token operator">|</span> SetCDARMacro

  <span class="token keyword">syntax</span> UnaryMacroToken <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> DIPMacro
                           <span class="token operator">|</span> MapCDARMacro

  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> NullaryMacroToken AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> UnaryMacroToken AnnotationList Block
</code></pre>
<p>Note: these macros require special runtime processing but are currently
<em>unimplemented</em>. Trying to use them will result in a parse error.</p>
<pre class="language-text"><code>  syntax NullaryMacroToken ::= PairMacro | UnpairMacro
  syntax PairMacro ::= r&quot;P[AIP]+R&quot; [token]
  syntax UnpairMacro ::= r&quot;UNP[AIP]+R&quot; [token]
</code></pre>
<p>The following macros can be validated at parse-time.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;DUP&quot;</span> AnnotationList <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPEQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPNEQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPLT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPGT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPLE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;CMPGE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFEQ&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFNEQ&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFLT&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFGT&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFLE&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFGE&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPEQ&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPNEQ&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPLT&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPGT&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPLE&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IFCMPGE&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;FAIL&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_EQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_NEQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_LT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_LE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_GT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_GE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPEQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPNEQ&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPLT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPLE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPGT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_CMPGE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_NONE&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_SOME&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_LEFT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ASSERT_RIGHT&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF_SOME&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;IF_RIGHT&quot;</span> AnnotationList Block Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SET_CAR&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;SET_CDR&quot;</span> AnnotationList
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;MAP_CAR&quot;</span> AnnotationList Block
  <span class="token keyword">syntax</span> Macro <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;MAP_CDR&quot;</span> AnnotationList Block
</code></pre>
<h3 id="primitive-applications">Primitive Applications</h3>
<p>We do not correctly parse Micheline primitive applications; we currently work
around the issue by allowing extra parens around potential primitive arguments.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> OptionData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> OptionData <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span><span class="token class-name">bracket</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Data       <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> Data <span class="token string">&quot;)&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">bracket</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Type       <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> Type <span class="token string">&quot;)&quot;</span>       <span class="token punctuation">[</span><span class="token class-name">bracket</span><span class="token punctuation">]</span>
</code></pre>
<h3 id="input-file-syntax">Input File Syntax</h3>
<p>At the top level, input files consist of groups which specify:</p>
<ul>
<li>parameters affecting the operation of the Michelson interpreter</li>
<li>parameters affecting the execution of Michelson unit tests</li>
</ul>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Groups <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Group
                  <span class="token operator">|</span> Group <span class="token string">&quot;;&quot;</span> Groups
  <span class="token keyword">syntax</span> Pgm <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Groups
</code></pre>
<h4 id="group-syntax">Group Syntax</h4>
<p>Typically, but not always, one loading group defined here corresponds to the
action of one instruction.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> ContractGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;contract&quot;</span> <span class="token string">&quot;{&quot;</span> Contract <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> NowGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;now&quot;</span> <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> SenderGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;sender&quot;</span> <span class="token keyword">String</span>
  <span class="token keyword">syntax</span> SourceGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;source&quot;</span> <span class="token keyword">String</span>
  <span class="token keyword">syntax</span> ChainGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;chain_id&quot;</span> MichelsonBytes
  <span class="token keyword">syntax</span> SelfGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;self&quot;</span> <span class="token keyword">String</span>
  <span class="token keyword">syntax</span> AmountGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;amount&quot;</span> <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> BalanceGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;balance&quot;</span> <span class="token keyword">Int</span>
  <span class="token keyword">syntax</span> ParameterValueGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;parameter_value&quot;</span> Data
  <span class="token keyword">syntax</span> StorageValueGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;storage_value&quot;</span> Data

  <span class="token keyword">syntax</span> ContractsGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;other_contracts&quot;</span> <span class="token string">&quot;{&quot;</span> OtherContractsMapEntryList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> OtherContractsMapEntry <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Contract&quot;</span> <span class="token keyword">String</span> Type
  <span class="token keyword">syntax</span> OtherContractsMapEntryList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>OtherContractsMapEntry<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>OtherContractsMapEntryList<span class="token punctuation">)</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> BigMapGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;big_maps&quot;</span> <span class="token string">&quot;{&quot;</span> BigMapEntryList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> BigMapEntry <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Big_map&quot;</span> <span class="token keyword">Int</span> Type Type NeMapLiteral
                       <span class="token operator">|</span> <span class="token string">&quot;Big_map&quot;</span> <span class="token keyword">Int</span> Type Type EmptyBlock
  <span class="token keyword">syntax</span> BigMapEntryList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>BigMapEntry<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>BigMapEntryList<span class="token punctuation">)</span><span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> ContractGroup
                 <span class="token operator">|</span> ParameterValueGroup
                 <span class="token operator">|</span> StorageValueGroup
                 <span class="token operator">|</span> NowGroup
                 <span class="token operator">|</span> SenderGroup
                 <span class="token operator">|</span> SourceGroup
                 <span class="token operator">|</span> ChainGroup
                 <span class="token operator">|</span> SelfGroup
                 <span class="token operator">|</span> AmountGroup
                 <span class="token operator">|</span> BalanceGroup
                 <span class="token operator">|</span> ContractsGroup
                 <span class="token operator">|</span> BigMapGroup
</code></pre>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
<h1 id="michelson-internal-syntax">Michelson Internal Syntax</h1>
<p>Michelson internal syntax describes an extension of the base Michelson grammar
to allow for defining values of types which are unrepresentable in the
standard Michelson syntax.</p>
<pre class="language-k"><code><span class="token keyword">module</span> MICHELSON<span class="token operator">-</span>INTERNAL<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
</code></pre>
<h2 id="operation-literals">Operation literals</h2>
<p>Here we define literals of type <code>operation</code> which correspond to values
produced by the <code>CREATE_CONTRACT</code>, <code>TRANSFER_TOKENS</code>, and <code>SET_DELEGATE</code>
instructions.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> SimpleData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> BlockchainOperation
</code></pre>
<ol>
<li>
<p>Values produced by the <code>CREATE_CONTRACT</code> instruction:</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> BlockchainOperation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span>
  <span class="token string">&quot;Create_contract&quot;</span> <span class="token string">&quot;{&quot;</span> Contract <span class="token string">&quot;}&quot;</span> OptionData MutezLiteral Data Data
</code></pre>
<ul>
<li>Contract (<code>contract</code>) The source code of the contract to originate; the
type of this contract determines storage type.</li>
<li>Delegate (<code>option key_hash</code>) An optional delegate specified by key hash.</li>
<li>Initial Balance (<code>mutez</code>) An initial balance to transfer to the new
contract.</li>
<li>Initial Storage (<code>T</code>) An initial storage value of the correct type.</li>
<li>Nonce (<code>byte</code>): A unique cryptographic nonce for this operation.</li>
</ul>
</li>
<li>
<p>Values produced by the <code>TRANSFER_TOKENS</code> instruction:</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> BlockchainOperation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Transfer_tokens&quot;</span> Data MutezLiteral AddressLiteral Data
</code></pre>
<ul>
<li>Parameter (<code>T</code>) The parameter passed to the contract being invoked
(or <code>Unit</code>, if the target contract is an implicit account).</li>
<li>Amount (<code>mutez</code>) The amount of mutez to transfer to the target contract.</li>
<li>Address (<code>address</code>) The address of the target contract.</li>
<li>Nonce (<code>byte</code>): A unique cryptographic nonce for this operation.</li>
</ul>
</li>
<li>
<p>Values produced by the <code>SET_DELEGATE</code> instruction:</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> BlockchainOperation <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Set_delegate&quot;</span> OptionData Data
</code></pre>
<ul>
<li>Delegate (<code>option key_hash</code>) An optional new delegate specified by
key hash; if <code>None</code>, then this operation clears the current delegate.</li>
<li>Nonce (<code>byte</code>): A unique cryptographic nonce for this operation.</li>
</ul>
</li>
</ol>
<h2 id="failed-stack-literals">Failed Stack Literals</h2>
<p>We need to represent the stack of Michelson code when execution fails.
We have failed stack literals for the following exceptional conditions:</p>
<ol>
<li>
<p>Exceuting a <code>FAILWITH</code> instruction; its argument is the value passed to
<code>FAILWITH</code>.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> FailedStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> <span class="token string">&quot;Failed&quot;</span> Data <span class="token string">&quot;)&quot;</span>
</code></pre>
</li>
<li>
<p>Executing an instruction that causes a <code>mutez</code> value to overflow
(producing a mutez value greater than 2^63-1); its arguments are the
mutez inputs to the instruction which overflowed.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> FailedStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> <span class="token string">&quot;MutezOverflow&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
</code></pre>
</li>
<li>
<p>Executing an instruction that causes a <code>mutez</code> value to underflow
(producing a mutez value less than 0); its arguments are the mutez inputs
to the instruction which underflowed.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> FailedStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> <span class="token string">&quot;MutezUnderflow&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
</code></pre>
</li>
<li>
<p>Executing an instruction which produces a non-mutez out-of-bound value
(e.g. the <code>LSL</code> and <code>LSR</code> instructions); its arguments are the numeric
inputs to the overflowing instruction.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> FailedStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;(&quot;</span> <span class="token string">&quot;GeneralOverflow&quot;</span> <span class="token keyword">Int</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
</code></pre>
</li>
</ol>
<h2 id="michelson-assertions">Michelson Assertions</h2>
<p>When running Michelson unit tests, we store pre- and post-conditions as lists
of Michelson sequences that produce a stack of the form <code>Stack_elt bool</code>.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> BlockList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>Block<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>BlockList<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre>
<h2 id="trailing-semicolons">Trailing semicolons</h2>
<p>Trailing semicolons are optional removed:</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Groups <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> groupSemicolon<span class="token punctuation">(</span>Group<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>groupSemicolon<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> groupSemicolon<span class="token punctuation">(</span>G<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> G <span class="token punctuation">[</span>anywhere<span class="token punctuation">]</span>
</code></pre>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
<h1 id="unit-test-syntax">Unit Test Syntax</h1>
<p>This module extends the Michelson script grammar to the <code>.tzt</code> <a href="https://gitlab.com/tezos/tezos/-/merge_requests/1487/diffs" target="_blank" rel="noopener">unit test
grammar</a>.</p>
<pre class="language-k"><code><span class="token keyword">module</span> UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>SYNTAX

<span class="token keyword">endmodule</span>
</code></pre>
<pre class="language-k"><code><span class="token keyword">module</span> UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>INTERNAL<span class="token operator">-</span>SYNTAX
</code></pre>
<h2 id="michelson-stack-syntax">Michelson Stack Syntax</h2>
<p>A stack is a Micheline sequence whose elements have the form <code>Stack_elt ty x</code>
where <code>x</code> is a Michelson value and <code>ty</code> is its type, e.g.</p>
<p><code>{ Stack_elt bool True ; Stack_elt nat 42 }</code></p>
<p>is a stack of length 2 whose top element is <code>True</code> and bottom element <code>42</code>.
We require that input stacks are well-formed. However, output stacks include
the degenerate case of failed stacks.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> StackElementLiteral <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Stack_elt&quot;</span> Type Data
  <span class="token keyword">syntax</span> StackElementList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span> StackElementLiteral<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token class-name">klabel</span><span class="token punctuation">(</span>StackElementList<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> LiteralStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;{&quot;</span> StackElementList <span class="token string">&quot;}&quot;</span>

  <span class="token keyword">syntax</span> OutputStack <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LiteralStack <span class="token operator">|</span> FailedStack
</code></pre>
<p>The wildcard pattern <code>_</code> can be used to omit part of the output stack. This is
typically used to omit the cryprographic nonce in <code>operation</code> values.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> Wildcard <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Wildcard
</code></pre>
<h2 id="unit-test-groups">Unit Test Groups</h2>
<p>Unit test files allow the following additional groups.</p>
<h3 id="mandatory-groups">Mandatory Groups</h3>
<ul>
<li>
<p><code>input</code> the initial stack to pass to the <code>code</code> block or instruction.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> InputGroup
<span class="token keyword">syntax</span> InputGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;input&quot;</span> LiteralStack
</code></pre>
</li>
<li>
<p><code>code</code> the instruction or instruction sequence to test.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> CodeGroup
<span class="token keyword">syntax</span> CodeGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> CodeDecl
</code></pre>
</li>
<li>
<p><code>output</code> the expected output stack.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> OutputGroup
<span class="token keyword">syntax</span> OutputGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;output&quot;</span> OutputStack
</code></pre>
</li>
</ul>
<h3 id="optional-groups">Optional Groups</h3>
<ul>
<li>
<p><code>test</code> wraps tests allowing for multiple tests in one file</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TestGroup
<span class="token keyword">syntax</span> TestGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;test&quot;</span> TestName <span class="token string">&quot;{&quot;</span> Groups <span class="token string">&quot;}&quot;</span>
<span class="token keyword">syntax</span> TestName <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">String</span>
</code></pre>
</li>
<li>
<p><code>parameter</code> (default <code>unit</code>) the type of the parameter of the contract
pushed by the <code>SELF</code> instruction.</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> ParameterGroup
<span class="token keyword">syntax</span> ParameterGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> ParameterDecl
</code></pre>
</li>
<li>
<p><code>import</code> groups map test fragments in files to strings for future usage</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> ImportGroup
<span class="token keyword">syntax</span> ImportGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;import&quot;</span> <span class="token keyword">String</span> <span class="token string">&quot;as&quot;</span> <span class="token keyword">String</span>
</code></pre>
</li>
<li>
<p><code>include</code> groups load either imported test fragments or raw files</p>
<pre class="language-k"><code><span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> IncludeGroup
<span class="token keyword">syntax</span> IncludeGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;include&quot;</span> <span class="token keyword">String</span>
                      <span class="token operator">|</span> <span class="token string">&quot;include-file&quot;</span> <span class="token keyword">String</span>
</code></pre>
</li>
</ul>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
<h1 id="symbolic-unit-test-syntax">Symbolic Unit Test Syntax</h1>
<p>We further extend the unit-test syntax with additional groups for representing
pre- and post-conditions as well as invariants to enable verification.</p>
<pre class="language-k"><code><span class="token keyword">module</span> SYMBOLIC<span class="token operator">-</span>UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> SYMBOLIC<span class="token operator">-</span>UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX

  <span class="token keyword">syntax</span> SymbolicData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;$[_a-zA-Z][_0-9a-zA-Z]*&quot;</span> <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
<pre class="language-k"><code><span class="token keyword">module</span> SYMBOLIC<span class="token operator">-</span>UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> UNIT<span class="token operator">-</span>TEST<span class="token operator">-</span>COMMON<span class="token operator">-</span>SYNTAX
</code></pre>
<p>We extend <code>Data</code> to allow symbolic variables.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> SymbolicData <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> Data <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> SymbolicData
</code></pre>
<p>We represent pre- and post-conditions as lists of blocks, where each block
contains a well-typed Michelson expression that consumes an empty input stack
and produces an output stack of type <code>Stack_elt bool _</code>.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> PreconditionGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;precondition&quot;</span> <span class="token string">&quot;{&quot;</span> BlockList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> PostconditionGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;postcondition&quot;</span> <span class="token string">&quot;{&quot;</span> BlockList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> PreconditionGroup <span class="token operator">|</span> PostconditionGroup
</code></pre>
<p>An invariant is an annotated pair of a stack shape (represented as a
<code>LiteralStack</code>) and a list of predicates (represented as <code>BlockList</code>).
The annotation determines to which looping instruction sequence (i.e. <code>LOOP</code>,
<code>LOOP_LEFT</code>, or <code>ITER</code>) an invariant corresponds.
When the program reaches the head of an annotated loop, we check that the actual
stack matches the specified stack shape.
Any symbolic variables in the stack shape are bound to the corresponding values
in the actual stack.
The predicate list represents invariants that must hold over all bound symbolic
variables.</p>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> InvariantsGroup <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;invariant&quot;</span> VariableAnnotation Invariant
  <span class="token keyword">syntax</span> Invariant <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LiteralStack <span class="token string">&quot;{&quot;</span> BlockList <span class="token string">&quot;}&quot;</span>
  <span class="token keyword">syntax</span> Group <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> InvariantsGroup
</code></pre>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#michelson-syntax" class="bd-toc-link">Michelson Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#michelson-parser-syntax"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Michelson Parser Syntax
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#michelson-common-syntax" class="bd-toc-link">Michelson Common Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#type-syntax"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Type Syntax
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#data-literal-syntax"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Data Literal Syntax
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#instruction-syntax" class="bd-toc-link">Instruction Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#nullary-instructions"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Nullary Instructions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#unary-instructions"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Unary Instructions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#binary-instructions"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Binary Instructions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#special-instructions"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Special Instructions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#debugging-instructions"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Debugging Instructions
              </a></div>
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#macro-syntax"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Macro Syntax
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#primitive-applications"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Primitive Applications
              </a></div><details style="padding:0.25rem 0;;padding-left: 16px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#input-file-syntax" class="bd-toc-link">Input File Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#group-syntax"
                class="bd-toc-link"
                style="padding-left: 24px;;"
              >
                Group Syntax
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#michelson-internal-syntax" class="bd-toc-link">Michelson Internal Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#operation-literals"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Operation literals
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#failed-stack-literals"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Failed Stack Literals
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#michelson-assertions"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Michelson Assertions
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#trailing-semicolons"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Trailing semicolons
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#unit-test-syntax" class="bd-toc-link">Unit Test Syntax</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#michelson-stack-syntax"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Michelson Stack Syntax
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#unit-test-groups" class="bd-toc-link">Unit Test Groups</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#mandatory-groups"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Mandatory Groups
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#optional-groups"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Optional Groups
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#symbolic-unit-test-syntax"
                class="bd-toc-link"
                style="padding-left: 0px;;"
              >
                Symbolic Unit Test Syntax
              </a></div>
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2021  all rights reserved</p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../assets/js/index.js"></script>
  </body>
</html>
