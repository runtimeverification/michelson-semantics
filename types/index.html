<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="A Michelson semantics for Tezos built using the K Framework."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="Michelson Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<!-- <link rel="icon" type="image/png" href="../assets/img/favicon.ico" /> -->

<title>Michelson Semantics | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../index.html"> Michelson Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/michelson-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../">Homepage</a>
      <a class="bd-toc-link" href="../INSTALL">Install</a>
      <a class="bd-toc-link" href="../USER_GUIDE">User Guide</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="michelson-type-checker">Michelson Type Checker</h1>
<pre class="language-k"><code><span class="token keyword">requires</span> <span class="token string">&quot;common.md&quot;</span>

<span class="token keyword">module</span> MICHELSON<span class="token operator">-</span>TYPES
  <span class="token keyword">imports</span> MICHELSON<span class="token operator">-</span>COMMON
  <span class="token keyword">imports</span> DOMAINS
</code></pre>
<h2 id="type-check-constructors">Type Check Constructors</h2>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> TypeContext <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Type <span class="token comment">// Parameter type.</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> List<span class="token punctuation">{</span>Type<span class="token punctuation">,</span> <span class="token string">&quot;;&quot;</span><span class="token punctuation">}</span>
  <span class="token keyword">syntax</span> TypeTransition <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypeSeq <span class="token string">&quot;-&gt;&quot;</span> TypeInput

  <span class="token keyword">syntax</span> FailureType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#ContractFailed&quot;</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypeSeq <span class="token operator">|</span> TypeError
  <span class="token keyword">syntax</span> TypeResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypeTransition <span class="token operator">|</span> TypeError <span class="token operator">|</span> FailureType

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TI<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeResult<span class="token punctuation">)</span>
  <span class="token keyword">syntax</span> TypedInstructions <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TIs<span class="token punctuation">(</span>TypedInstructionList<span class="token punctuation">,</span> TypeResult<span class="token punctuation">)</span>
  <span class="token keyword">syntax</span> TypedInstructionList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypedInstruction <span class="token string">&quot;;&quot;</span> TypedInstructionList <span class="token operator">|</span> TypedInstruction
                                <span class="token operator">|</span> #Remaining<span class="token punctuation">(</span>DataList<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeError <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #InvalidTypeForInstruction<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>unused<span class="token punctuation">]</span>
                     <span class="token operator">|</span> #IncompatibleTypesForBranch<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeInput<span class="token punctuation">,</span> TypeInput<span class="token punctuation">)</span>
                     <span class="token operator">|</span> <span class="token string">&quot;#UnexpectedFailureType&quot;</span>
                     <span class="token operator">|</span> <span class="token string">&quot;#InternalError&quot;</span>
                     <span class="token operator">|</span> #MistypedData<span class="token punctuation">(</span>Data<span class="token punctuation">,</span> Type<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #MistypedInnerData<span class="token punctuation">(</span>List<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #IllTypedLambda<span class="token punctuation">(</span>TypedInstruction<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> Type<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #SequenceError<span class="token punctuation">(</span>TypeInput<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #CreateContractError<span class="token punctuation">(</span>TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #DIPError<span class="token punctuation">(</span>TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidDIP<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span>
                     <span class="token operator">|</span> #LambdaError<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #IllTypedLambdaInst<span class="token punctuation">(</span>TypedInstruction<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> <span class="token keyword">Bool</span><span class="token punctuation">,</span> <span class="token keyword">Bool</span><span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidPostIterationStack<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #IllegalBranchInstruction<span class="token punctuation">(</span>Instruction<span class="token punctuation">)</span> <span class="token comment">// Internal error.</span>
                     <span class="token operator">|</span> #MultipleTypeErrors<span class="token punctuation">(</span>TypeError<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidPush<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeError<span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidDropCount<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidDigCount<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
                     <span class="token operator">|</span> #InvalidDugCount<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #InvalidBranchInstruction<span class="token punctuation">(</span>Instruction<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> MaybeData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> TypedData <span class="token operator">|</span> TypeError
  <span class="token keyword">syntax</span> MaybeType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Type <span class="token operator">|</span> <span class="token string">&quot;#NoType&quot;</span>

  <span class="token keyword">syntax</span> DataList <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #Exec<span class="token punctuation">(</span>TypedInstructionList<span class="token punctuation">)</span>
</code></pre>
<h2 id="type-checking-rules">Type Checking Rules</h2>
<pre class="language-k"><code>  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeInstruction<span class="token punctuation">(</span>TypeContext<span class="token punctuation">,</span> Instruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> TypedInstructions <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeInstructions<span class="token punctuation">(</span>TypeContext<span class="token punctuation">,</span> DataList<span class="token punctuation">,</span> TypeInput<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #EndType<span class="token punctuation">(</span>TypeResult<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #EndType<span class="token punctuation">(</span>TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #EndType<span class="token punctuation">(</span>_<span class="token punctuation">:</span>TypeSeq <span class="token operator">-</span>&gt; TR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TR
  <span class="token keyword">rule</span> #EndType<span class="token punctuation">(</span>#ContractFailed<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #UnexpectedFailureType

  <span class="token keyword">syntax</span> TypeResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #MergeResults<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> TypeResult<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MergeResults<span class="token punctuation">(</span>_<span class="token punctuation">,</span> E<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> E
  <span class="token keyword">rule</span> #MergeResults<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ContractFailed
  <span class="token keyword">rule</span> #MergeResults<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; TD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TS <span class="token operator">-</span>&gt; TD

  <span class="token keyword">syntax</span> MaybeData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeData<span class="token punctuation">(</span>TypeContext<span class="token punctuation">,</span> Data<span class="token punctuation">,</span> Type<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> MaybeData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #CheckInnerData<span class="token punctuation">(</span>Data<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> List<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> D<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #MistypedData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> Unit<span class="token punctuation">,</span> unit _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>Unit<span class="token punctuation">,</span> unit <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span>MichelsonBytes<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>chain_id _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>string _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span>MichelsonBytes<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
       <span class="token keyword">requires</span> #IsLegalMutezValue<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">Bool</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>key_hash _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>address _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>key _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>signature _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>Pair VL VR<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ TL TR<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> VL<span class="token punctuation">,</span> TL<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> VR<span class="token punctuation">,</span> TR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>Some V<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>option _ TI<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">,</span> TI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> None     #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>option _  _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>Left V<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>or _ TI _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">,</span> TI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>Right V<span class="token punctuation">)</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>or _ _ TI<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">,</span> TI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> D<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>contract _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #AllWellTyped<span class="token punctuation">(</span>List<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #AllWellTyped<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>#Typed<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">)</span> L<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #AllWellTyped<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #AllWellTyped<span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #AllWellTyped<span class="token punctuation">(</span><span class="token punctuation">.</span>List<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span>


  <span class="token keyword">rule</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> L<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token keyword">requires</span> #AllWellTyped<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #CheckInnerData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> L<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #MistypedInnerData<span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> MaybeData <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeLambdaAux<span class="token punctuation">(</span>TypedInstruction<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> Type<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">:</span>Block<span class="token punctuation">,</span> lambda _ T1 T2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TypeLambdaAux<span class="token punctuation">(</span>#TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T1<span class="token punctuation">)</span><span class="token punctuation">,</span> T1<span class="token punctuation">,</span> T2<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> #Lambda<span class="token punctuation">(</span>TN1<span class="token punctuation">,</span> TN2<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">,</span> lambda _ T1 T2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TypeLambdaAux<span class="token punctuation">(</span>#TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T1<span class="token punctuation">)</span><span class="token punctuation">,</span> T1<span class="token punctuation">,</span> T2<span class="token punctuation">)</span>
    <span class="token keyword">requires</span> #Name<span class="token punctuation">(</span>T1<span class="token punctuation">)</span> <span class="token operator">==</span>K TN1
     andBool #Name<span class="token punctuation">(</span>T2<span class="token punctuation">)</span> <span class="token operator">==</span>K TN2

  <span class="token keyword">rule</span> #TypeLambdaAux<span class="token punctuation">(</span><span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> T1<span class="token punctuation">:</span>Type <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq <span class="token operator">-</span>&gt; T2<span class="token punctuation">:</span>Type <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> #as B<span class="token punctuation">)</span><span class="token punctuation">,</span> T1<span class="token punctuation">:</span>Type<span class="token punctuation">,</span> T2<span class="token punctuation">:</span>Type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span><span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> lambda <span class="token punctuation">.</span>AnnotationList T1 T2<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeLambdaAux<span class="token punctuation">(</span>T<span class="token punctuation">,</span> T1<span class="token punctuation">,</span> T2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #IllTypedLambda<span class="token punctuation">(</span>T<span class="token punctuation">,</span> T1<span class="token punctuation">,</span> T2<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>


  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>set _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>big_map _ _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> List <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeCheckListElements<span class="token punctuation">(</span>TypeContext<span class="token punctuation">,</span> DataList<span class="token punctuation">,</span> Type<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeCheckListElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> D<span class="token punctuation">:</span>Data<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> D<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeCheckListElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> D <span class="token punctuation">;</span> DL<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> D<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">)</span> #TypeCheckListElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DL<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">{</span> DL <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ TI<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> #TypeCheckListElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DL<span class="token punctuation">,</span> TI<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">{</span> DL <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>set _ TI<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> #TypeCheckListElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DL<span class="token punctuation">,</span> TI<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> List <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #TypeCheckMapElements<span class="token punctuation">(</span>TypeContext<span class="token punctuation">,</span> MapEntryList<span class="token punctuation">,</span> Type<span class="token punctuation">,</span> Type<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #TypeCheckMapElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> Elt K V<span class="token punctuation">,</span> KT<span class="token punctuation">,</span> VT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KT<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">,</span> VT<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeCheckMapElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> Elt K V <span class="token punctuation">;</span> Rs<span class="token punctuation">,</span> KT<span class="token punctuation">,</span> VT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KT<span class="token punctuation">)</span><span class="token punctuation">)</span> ListItem<span class="token punctuation">(</span>#TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">,</span> VT<span class="token punctuation">)</span><span class="token punctuation">)</span> #TypeCheckMapElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> Rs<span class="token punctuation">,</span> KT<span class="token punctuation">,</span> VT<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">{</span> DL <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ KT VT<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> #TypeCheckMapElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DL<span class="token punctuation">,</span> KT<span class="token punctuation">,</span> VT<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">{</span> DL <span class="token punctuation">}</span> #as D<span class="token punctuation">,</span> <span class="token punctuation">(</span>big_map _ KT VT<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CheckInnerData<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">,</span> #TypeCheckMapElements<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DL<span class="token punctuation">,</span> KT<span class="token punctuation">,</span> VT<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>big_map _ _ _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>Create_contract<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> #as D<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>operation _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>Transfer_tokens<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> #as D<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>operation _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>Set_delegate<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span> #as D<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>operation _<span class="token punctuation">)</span> #as T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>D<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeData<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #Any<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Typed<span class="token punctuation">(</span>#Any<span class="token punctuation">,</span> T<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> TS <span class="token operator">-</span>&gt; TS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">{</span> Is<span class="token punctuation">:</span>DataList <span class="token punctuation">}</span><span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #fun<span class="token punctuation">(</span>#TIs<span class="token punctuation">(</span>Is2<span class="token punctuation">,</span> TR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>Is2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> TR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>#TypeInstructions<span class="token punctuation">(</span>C<span class="token punctuation">,</span> Is<span class="token punctuation">,</span> TS<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstructions<span class="token punctuation">(</span>_<span class="token punctuation">,</span> Is<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TIs<span class="token punctuation">(</span>#Remaining<span class="token punctuation">(</span>Is<span class="token punctuation">)</span><span class="token punctuation">,</span> TE<span class="token punctuation">)</span>


  <span class="token keyword">rule</span> #TypeInstructions<span class="token punctuation">(</span>_<span class="token punctuation">,</span> Is<span class="token punctuation">,</span> TR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TIs<span class="token punctuation">(</span>#Remaining<span class="token punctuation">(</span>Is<span class="token punctuation">)</span><span class="token punctuation">,</span> #SequenceError<span class="token punctuation">(</span>TR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>



  <span class="token keyword">rule</span> #TypeInstructions<span class="token punctuation">(</span>C<span class="token punctuation">,</span> I1 <span class="token punctuation">;</span> Is<span class="token punctuation">,</span> Input<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #fun<span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TR1<span class="token punctuation">)</span> #as T <span class="token operator">=&gt;</span> #fun<span class="token punctuation">(</span>#TIs<span class="token punctuation">(</span>Ts2<span class="token punctuation">,</span> TR2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TIs<span class="token punctuation">(</span>T <span class="token punctuation">;</span> Ts2<span class="token punctuation">,</span> #MergeResults<span class="token punctuation">(</span>Input<span class="token punctuation">,</span> TR2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>#TypeInstructions<span class="token punctuation">(</span>C<span class="token punctuation">,</span> Is<span class="token punctuation">,</span> #EndType<span class="token punctuation">(</span>TR1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>#TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> I1<span class="token punctuation">,</span> Input<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstructions<span class="token punctuation">(</span>C<span class="token punctuation">,</span> I<span class="token punctuation">:</span>Instruction<span class="token punctuation">,</span> TS<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #fun<span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>I2<span class="token punctuation">,</span> TR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TIs<span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>I2<span class="token punctuation">,</span> TR<span class="token punctuation">)</span><span class="token punctuation">,</span> TR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span>#TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> I<span class="token punctuation">,</span> TS<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>DROP _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Rs<span class="token punctuation">)</span> #as T1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token operator">-</span>&gt; Rs<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>DROP _ N<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> T1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token operator">-</span>&gt; #DropFirst<span class="token punctuation">(</span>T1<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DropFirst<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #DropFirst<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InvalidDropCount<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #DropFirst<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TS
  <span class="token keyword">rule</span> #DropFirst<span class="token punctuation">(</span>_ <span class="token punctuation">;</span> TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #DropFirst<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>


  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>DIG _ N<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> T1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token operator">-</span>&gt; #DigType<span class="token punctuation">(</span>T1<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span>


  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DigType<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #DigType<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #DigTypeAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> #GetTypeN<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DigTypeAux<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> MaybeType<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #DigTypeAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> T<span class="token punctuation">:</span>Type<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T <span class="token punctuation">;</span> #RemoveN<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #DigTypeAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> #NoType<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InvalidDigCount<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> MaybeType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #GetTypeN<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #GetTypeN<span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> _<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T1
  <span class="token keyword">rule</span> #GetTypeN<span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #GetTypeN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #GetTypeN<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #NoType <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #RemoveN<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #RemoveN<span class="token punctuation">(</span>_  <span class="token punctuation">;</span> Ts<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Ts
  <span class="token keyword">rule</span> #RemoveN<span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T1 <span class="token punctuation">;</span> #RemoveN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #RemoveN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Ts <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// This rule is unreachable.</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #RemoveFirstN<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #RemoveFirstN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Ts
  <span class="token keyword">rule</span> #RemoveFirstN<span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #RemoveFirstN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #RemoveFirstN<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Ts <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// This rule is unreachable.</span>



  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>DUG _ N<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> T1<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token operator">-</span>&gt; #DoDug<span class="token punctuation">(</span>T1<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #LengthTypeSeq<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #LengthTypeSeq<span class="token punctuation">(</span><span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #LengthTypeSeq<span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> #LengthTypeSeq<span class="token punctuation">(</span>Ts<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DoDug<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #DoDug<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InvalidDugCount<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token keyword">requires</span> #LengthTypeSeq<span class="token punctuation">(</span>TS<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token keyword">Int</span> I orBool
                                                           I &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #DoDug<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TS
  <span class="token keyword">rule</span> #DoDug<span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> TS<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #DoDugAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> T1<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DoDugAux<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> Type<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #DoDugAux<span class="token punctuation">(</span>_<span class="token punctuation">,</span> I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>TypeSeq <span class="token keyword">requires</span> I &lt;<span class="token keyword">Int</span> <span class="token number">0</span> <span class="token comment">// This pattern is unreachable.</span>
  <span class="token keyword">rule</span> #DoDugAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T <span class="token punctuation">;</span> TS
  <span class="token keyword">rule</span> #DoDugAux<span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> TS<span class="token punctuation">,</span> I<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T1 <span class="token punctuation">;</span> #DoDugAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>DUP _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token punctuation">;</span> Ts <span class="token operator">-</span>&gt; T1 <span class="token punctuation">;</span> T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SWAP _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> T1 <span class="token punctuation">;</span> T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T1 <span class="token punctuation">;</span> T2 <span class="token punctuation">;</span> Ts <span class="token operator">-</span>&gt; T2 <span class="token punctuation">;</span> T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #PushAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> MaybeData<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #PushAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #PushAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InvalidPush<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #PushAux<span class="token punctuation">(</span>PUSH _ T _<span class="token punctuation">,</span> TD<span class="token punctuation">:</span>TypedData<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>PUSH <span class="token punctuation">.</span>AnnotationList T TD<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>PUSH _ T D<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #PushAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeData<span class="token punctuation">(</span>C<span class="token punctuation">,</span> D<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SOME _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NONE _ T<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UNIT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; unit <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #UnifyBranches<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>IF_NONE _ B1 B2<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>option _ T1 <span class="token punctuation">;</span> Ts1<span class="token punctuation">)</span> #as Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> Ts1<span class="token punctuation">)</span><span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B2<span class="token punctuation">,</span> T1 <span class="token punctuation">;</span> Ts1<span class="token punctuation">)</span><span class="token punctuation">,</span> Os<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> Instruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #SubTypedBranches<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> Block<span class="token punctuation">,</span> Block<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #SubTypedBranches<span class="token punctuation">(</span>IF_NONE _ _ _<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> B2<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> IF_NONE  <span class="token punctuation">.</span>AnnotationList B1 B2
  <span class="token keyword">rule</span> #SubTypedBranches<span class="token punctuation">(</span>IF_LEFT _ _ _<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> B2<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> IF_LEFT  <span class="token punctuation">.</span>AnnotationList B1 B2
  <span class="token keyword">rule</span> #SubTypedBranches<span class="token punctuation">(</span>IF_CONS _ _ _<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> B2<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> IF_CONS  <span class="token punctuation">.</span>AnnotationList B1 B2
  <span class="token keyword">rule</span> #SubTypedBranches<span class="token punctuation">(</span>IF      _ _ _<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> B2<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> IF       <span class="token punctuation">.</span>AnnotationList B1 B2
  <span class="token keyword">rule</span> #SubTypedBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InvalidBranchInstruction<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>


  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #MakeTypedBranch<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypeTransition<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MakeTypedBranch<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MakeTypedBranch<span class="token punctuation">(</span>#InvalidBranchInstruction<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #IllegalBranchInstruction<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; D<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> #as B1<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; D<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> #as B2<span class="token punctuation">,</span> Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       #MakeTypedBranch<span class="token punctuation">(</span>#SubTypedBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B1<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; D<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; V1<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span><span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; V2<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #IncompatibleTypesForBranch<span class="token punctuation">(</span>I<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> V2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> V1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K V2

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> #as B1<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; D<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> #as B2<span class="token punctuation">,</span> Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       #MakeTypedBranch<span class="token punctuation">(</span>#SubTypedBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B1<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; D<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; D<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> #as B1<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> #as B2<span class="token punctuation">,</span> Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       #MakeTypedBranch<span class="token punctuation">(</span>#SubTypedBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B1<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B2<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; D<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span>       <span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span>       <span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #UnexpectedFailureType<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; _<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; _<span class="token punctuation">)</span><span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE1<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE2<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #MultipleTypeErrors<span class="token punctuation">(</span>TE1<span class="token punctuation">,</span> TE2<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// Unreachable.</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>PAIR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; pair <span class="token punctuation">.</span>AnnotationList T1 T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UNPAIR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ T1 T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; T1 <span class="token punctuation">;</span> T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CAR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ T1 _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; T1 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CDR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ _ T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Os <span class="token operator">-</span>&gt; T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>LEFT _ TR<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>TL <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>or <span class="token punctuation">.</span>AnnotationList TL TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>RIGHT _ TL<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>TR <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>or <span class="token punctuation">.</span>AnnotationList TL TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>IF_LEFT _ BL BR<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>or _ TL TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> BL<span class="token punctuation">,</span> TL <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> BR<span class="token punctuation">,</span> TR <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>


  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NIL _ T<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>list <span class="token punctuation">.</span>AnnotationList T<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONS _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T <span class="token punctuation">;</span> list _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; list <span class="token punctuation">.</span>AnnotationList T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>IF_CONS _ B1 B2<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B1<span class="token punctuation">,</span> T <span class="token punctuation">;</span> list <span class="token punctuation">.</span>AnnotationList T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B2<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>set _ _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ _ _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>string _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EMPTY_SET _ T<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; set <span class="token punctuation">.</span>AnnotationList T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EMPTY_MAP _ KT VT<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; map <span class="token punctuation">.</span>AnnotationList KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EMPTY_BIG_MAP _ KT VT<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; big_map <span class="token punctuation">.</span>AnnotationList KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token comment">// rule #TypeInstruction(_, I, T) =&gt; #TI(I, #InvalidTypeForInstruction(I, T)) [owise]</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #MapAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>MAP _ _<span class="token punctuation">,</span> <span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; N <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>MAP <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>list <span class="token punctuation">.</span>AnnotationList N<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>MAP _ _<span class="token punctuation">,</span> <span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ KT _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>MAP <span class="token punctuation">.</span>AnnotationList  <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>map <span class="token punctuation">.</span>AnnotationList KT VT<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts1<span class="token punctuation">)</span> #as DS<span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts2<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InvalidPostIterationStack<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS<span class="token punctuation">,</span> DS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> Ts1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K Ts2
  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span><span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #UnexpectedFailureType<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// Unreachable</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>MAP _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>MAP _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #MapAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair <span class="token punctuation">.</span>AnnotationList KT VT<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>


  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #IterAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #IterAux<span class="token punctuation">(</span>ITER _ _<span class="token punctuation">,</span> <span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; Ts<span class="token punctuation">)</span> #as B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>ITER <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token punctuation">(</span>#TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; Ts1<span class="token punctuation">)</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts2<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InvalidPostIterationStack<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS<span class="token punctuation">,</span> Ts1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> Ts1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K Ts2
  <span class="token keyword">rule</span> #IterAux<span class="token punctuation">(</span>ITER _ _<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span>  <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>ITER <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// Unreachable</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>ITER _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>ITER _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>set _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>ITER _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #IterAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair <span class="token punctuation">.</span>AnnotationList KT VT<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MEM _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> map _ KT _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MEM _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> big_map _ KT _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MEM _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T <span class="token punctuation">;</span> set _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>GET _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>GET _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> big_map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>


  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UPDATE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> option _ VT <span class="token punctuation">;</span> map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; map <span class="token punctuation">.</span>AnnotationList KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UPDATE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>KT <span class="token punctuation">;</span> option _ VT <span class="token punctuation">;</span> big_map _ KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; big_map <span class="token punctuation">.</span>AnnotationList KT VT <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UPDATE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T <span class="token punctuation">;</span> bool _ <span class="token punctuation">;</span> set _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; set <span class="token punctuation">.</span>AnnotationList T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>IF _ BL BR<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #UnifyBranches<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> BL<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> BR<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #LoopAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #LoopAux<span class="token punctuation">(</span> LOOP A _ <span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> Ts <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool _<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bool _<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">(</span>LOOP A <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; Ts1<span class="token punctuation">)</span><span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InvalidPostIterationStack<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts1<span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> Ts1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K Ts2
  <span class="token keyword">rule</span> #LoopAux<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bool _<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">(</span>LOOP <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// Unreachable</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>LOOP _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bool _<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #LoopAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #LoopLeftAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #LoopLeftAux<span class="token punctuation">(</span>LOOP_LEFT A _<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TL <span class="token punctuation">;</span> Ts <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>or _ TL TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>or _ TL TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">(</span>LOOP_LEFT A <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; TR <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopLeftAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _ <span class="token operator">-</span>&gt; Ts1<span class="token punctuation">)</span><span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InvalidPostIterationStack<span class="token punctuation">(</span>I<span class="token punctuation">,</span> Ts1<span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> Ts1 <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K Ts2
  <span class="token keyword">rule</span> #LoopLeftAux<span class="token punctuation">(</span>LOOP_LEFT A _<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span>or _ _ TR<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span><span class="token punctuation">(</span>LOOP_LEFT A <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; TR <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopLeftAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span><span class="token punctuation">,</span>  _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TE<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LoopLeftAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #InternalError<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>LOOP_LEFT _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>or _ TL _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #LoopLeftAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> TL <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #LambdaAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>


  <span class="token keyword">rule</span> #LambdaAux<span class="token punctuation">(</span>LAMBDA _ T1<span class="token punctuation">:</span>Type T2<span class="token punctuation">:</span>Type _<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> T1<span class="token punctuation">:</span>Type <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq <span class="token operator">-</span>&gt; T2<span class="token punctuation">:</span>Type <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>LAMBDA <span class="token punctuation">.</span>AnnotationList T1 T2 <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; lambda <span class="token punctuation">.</span>AnnotationList T1 T2 <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #LambdaAux<span class="token punctuation">(</span>LAMBDA _ T1 T2 _ #as I<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> T3 <span class="token operator">-</span>&gt; T4<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #IllTypedLambdaInst<span class="token punctuation">(</span>B<span class="token punctuation">,</span> T1<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> <span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">==</span>K T3<span class="token punctuation">,</span> <span class="token punctuation">(</span>T2 <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">==</span>K T4<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">requires</span> <span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K T3 orBool <span class="token punctuation">(</span>T2 <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K T4


  <span class="token keyword">rule</span> #LambdaAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #LambdaError<span class="token punctuation">(</span>I<span class="token punctuation">,</span> T<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>LAMBDA _ T1 _ B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> Os<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #LambdaAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> T1<span class="token punctuation">)</span><span class="token punctuation">,</span> Os<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EXEC _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T1 <span class="token punctuation">;</span> lambda _ T1 T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>APPLY _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>TL <span class="token punctuation">;</span> lambda _ <span class="token punctuation">(</span>pair <span class="token punctuation">.</span>AnnotationList TL TR<span class="token punctuation">)</span> T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; lambda <span class="token punctuation">.</span>AnnotationList TR T2 <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #FirstN<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #FirstN<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #FirstNAux<span class="token punctuation">(</span>TS<span class="token punctuation">,</span> N<span class="token punctuation">,</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ReverseTypeSeq<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #ReverseTypeSeq<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ReverseTypeSeqAux<span class="token punctuation">(</span>T<span class="token punctuation">,</span> <span class="token punctuation">.</span>TypeSeq<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ReverseTypeSeqAux<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #ReverseTypeSeqAux<span class="token punctuation">(</span>T <span class="token punctuation">;</span> Ts1<span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ReverseTypeSeqAux<span class="token punctuation">(</span>Ts1<span class="token punctuation">,</span> T <span class="token punctuation">;</span> Ts2<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #ReverseTypeSeqAux<span class="token punctuation">(</span><span class="token punctuation">.</span>TypeSeq<span class="token punctuation">,</span> Ts<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Ts

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #FirstNAux<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> TypeInput<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #FirstNAux<span class="token punctuation">(</span>_<span class="token punctuation">,</span> I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InternalError                               <span class="token keyword">requires</span> I &lt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #FirstNAux<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #FirstNAux<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> TS<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ReverseTypeSeq<span class="token punctuation">(</span>TS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #FirstNAux<span class="token punctuation">(</span>T <span class="token punctuation">;</span> Ts<span class="token punctuation">,</span> I<span class="token punctuation">,</span> R<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #FirstNAux<span class="token punctuation">(</span>Ts<span class="token punctuation">,</span> I <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> T <span class="token punctuation">;</span> R<span class="token punctuation">)</span> <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
  <span class="token keyword">rule</span> #FirstNAux<span class="token punctuation">(</span><span class="token punctuation">.</span>TypeSeq<span class="token punctuation">,</span> I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #InvalidDIP<span class="token punctuation">(</span>I<span class="token punctuation">)</span>                        <span class="token keyword">requires</span> I &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DIP A B<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> DIP A <span class="token number">1</span> B<span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeInput <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #MakeConcat<span class="token punctuation">(</span>TypeInput<span class="token punctuation">,</span> TypeInput<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MakeConcat<span class="token punctuation">(</span>TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #MakeConcat<span class="token punctuation">(</span>_<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #MakeConcat<span class="token punctuation">(</span>T1<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">,</span> T2<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #Concat<span class="token punctuation">(</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypeResult <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #MakeTransition<span class="token punctuation">(</span>TypeInput<span class="token punctuation">,</span> TypeInput<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #MakeTransition<span class="token punctuation">(</span>TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #MakeTransition<span class="token punctuation">(</span>_<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">,</span> TE<span class="token punctuation">:</span>TypeError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TE
  <span class="token keyword">rule</span> #MakeTransition<span class="token punctuation">(</span>T1<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">,</span> T2<span class="token punctuation">:</span>TypeSeq<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> T1 <span class="token operator">-</span>&gt; T2



  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #Concat<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #Concat<span class="token punctuation">(</span>TS1<span class="token punctuation">,</span> TS2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ConcatAux<span class="token punctuation">(</span>#ReverseTypeSeq<span class="token punctuation">(</span>TS1<span class="token punctuation">)</span><span class="token punctuation">,</span> TS2<span class="token punctuation">)</span>


  <span class="token keyword">syntax</span> TypeSeq <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #ConcatAux<span class="token punctuation">(</span>TypeSeq<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
  <span class="token keyword">rule</span> #ConcatAux<span class="token punctuation">(</span><span class="token punctuation">.</span>TypeSeq<span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TS
  <span class="token keyword">rule</span> #ConcatAux<span class="token punctuation">(</span>T <span class="token punctuation">;</span> TS1<span class="token punctuation">,</span> TS2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #ConcatAux<span class="token punctuation">(</span>TS1<span class="token punctuation">,</span> T <span class="token punctuation">;</span> TS2<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #DIPAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>


  <span class="token keyword">rule</span> #DIPAux<span class="token punctuation">(</span>DIP _ N _<span class="token punctuation">,</span> #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> Ts1 <span class="token operator">-</span>&gt; Ts2<span class="token punctuation">)</span> #as B<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>DIP <span class="token punctuation">.</span>AnnotationList N <span class="token punctuation">{</span> #Exec<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> #MakeTransition<span class="token punctuation">(</span>OS<span class="token punctuation">,</span> #MakeConcat<span class="token punctuation">(</span>#FirstN<span class="token punctuation">(</span>OS<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">,</span> Ts2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">requires</span> #RemoveFirstN<span class="token punctuation">(</span>OS<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">==</span>K Ts1
  <span class="token keyword">rule</span> #DIPAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TI<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #DIPError<span class="token punctuation">(</span>TI<span class="token punctuation">,</span> OS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span> <span class="token comment">// TODO: Better error messages.</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>DIP _ N B<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #DIPAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> B<span class="token punctuation">,</span> #RemoveFirstN<span class="token punctuation">(</span>OS<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>FAILWITH _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #ContractFailed<span class="token punctuation">)</span>
  <span class="token comment">// rule #TypeInstruction(_, (CAST _) #as I, Ts) =&gt; #TI(I, Ts -&gt; Ts)</span>
  <span class="token comment">// rule #TypeInstruction(_, (RENAME _) #as I, Ts) =&gt; #TI(I, Ts -&gt; Ts)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONCAT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>string _ <span class="token punctuation">;</span> string _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>string <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONCAT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bytes <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONCAT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>list _ string _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>string <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONCAT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span>  <span class="token punctuation">(</span>list _ bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bytes <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>



  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SLICE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> string _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>option <span class="token punctuation">.</span>AnnotationList string <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SLICE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>option <span class="token punctuation">.</span>AnnotationList bytes <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>PACK _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>_ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; bytes <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>UNPACK _ T<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>option <span class="token punctuation">.</span>AnnotationList T<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> timestamp _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; timestamp <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; timestamp <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADD _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; timestamp <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _ <span class="token punctuation">;</span> timestamp _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SUB _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>MUL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList int <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList int <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList int <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList mutez <span class="token punctuation">.</span>AnnotationList mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EDIV _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; option <span class="token punctuation">.</span>AnnotationList pair <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList mutez <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ABS _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ISNAT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>option <span class="token punctuation">.</span>AnnotationList nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>INT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NEG _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NEG _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>LSL _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>LSR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>OR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>OR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>AND _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>AND _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>AND _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>XOR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>nat <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>XOR _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NOT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NOT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NOT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>nat _ <span class="token punctuation">;</span> nat _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bool _ <span class="token punctuation">;</span> bool _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>string _ <span class="token punctuation">;</span> string _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ A B <span class="token punctuation">;</span> pair _ A B <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>timestamp _ <span class="token punctuation">;</span> timestamp _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>mutez _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>COMPARE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>key_hash _ <span class="token punctuation">;</span> key_hash _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>int <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>EQ _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NEQ _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>LT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>GT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>LE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>GE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>int _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>C<span class="token punctuation">,</span> <span class="token punctuation">(</span>SELF _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>contract <span class="token punctuation">.</span>AnnotationList C<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CONTRACT _ T<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>address _<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>option <span class="token punctuation">.</span>AnnotationList contract <span class="token punctuation">.</span>AnnotationList T<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>TRANSFER_TOKENS _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>T <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> contract _ T <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>operation <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SET_DELEGATE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>option _ key_hash _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>operation <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>NOW _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>timestamp <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CHAIN_ID _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>chain_id <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>AMOUNT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>mutez <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>BALANCE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>mutez <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CHECK_SIGNATURE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>key _ <span class="token punctuation">;</span> signature _ <span class="token punctuation">;</span> bytes _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; bool <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>BLAKE2B _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> _<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SHA256 _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> _<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SHA512 _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>bytes _ <span class="token punctuation">;</span> _<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>HASH_KEY _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>key _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>key_hash <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SOURCE _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>address <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>SENDER _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>address <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>ADDRESS _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>contract _ _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>address <span class="token punctuation">.</span>AnnotationList<span class="token punctuation">)</span> <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>TRACE<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> STOP       #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> PAUSE      #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>PAUSE<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; OS<span class="token punctuation">)</span>

  <span class="token keyword">syntax</span> TypedInstruction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #CreateContractAux<span class="token punctuation">(</span>Instruction<span class="token punctuation">,</span> TypedInstruction<span class="token punctuation">,</span> TypeSeq<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>


  <span class="token keyword">rule</span> #CreateContractAux<span class="token punctuation">(</span><span class="token punctuation">(</span>CREATE_CONTRACT _ <span class="token punctuation">{</span> code B <span class="token punctuation">;</span> storage St <span class="token punctuation">;</span> parameter Pt <span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
                          #TI<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>pair _ Pt St<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>pair _ <span class="token punctuation">(</span>list _ operation _<span class="token punctuation">)</span> St<span class="token punctuation">)</span> <span class="token punctuation">;</span> <span class="token punctuation">.</span>TypeSeq <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>option _ key_hash _ <span class="token punctuation">;</span> mutez _ <span class="token punctuation">;</span> St <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
       #TI<span class="token punctuation">(</span>CREATE_CONTRACT <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">{</span> code B <span class="token punctuation">;</span> storage St <span class="token punctuation">;</span> parameter Pt <span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; operation <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> address <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span>
  <span class="token keyword">rule</span> #CreateContractAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> TI<span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #CreateContractError<span class="token punctuation">(</span>TI<span class="token punctuation">,</span> TS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>CREATE_CONTRACT _ <span class="token punctuation">{</span> code B <span class="token punctuation">;</span> storage St <span class="token punctuation">;</span> parameter Pt <span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #CreateContractAux<span class="token punctuation">(</span>I<span class="token punctuation">,</span> #TypeInstruction<span class="token punctuation">(</span>Pt<span class="token punctuation">,</span> B<span class="token punctuation">,</span> pair <span class="token punctuation">.</span>AnnotationList Pt St<span class="token punctuation">)</span><span class="token punctuation">,</span> OS<span class="token punctuation">)</span>

  <span class="token keyword">rule</span> #TypeInstruction<span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token punctuation">(</span>IMPLICIT_ACCOUNT _<span class="token punctuation">)</span> #as I<span class="token punctuation">,</span> <span class="token punctuation">(</span>key_hash _ <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span> #as OS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #TI<span class="token punctuation">(</span>I<span class="token punctuation">,</span> OS <span class="token operator">-</span>&gt; <span class="token punctuation">(</span>contract <span class="token punctuation">.</span>AnnotationList unit <span class="token punctuation">.</span>AnnotationList <span class="token punctuation">;</span> Ts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#michelson-type-checker" class="bd-toc-link">Michelson Type Checker</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#type-check-constructors"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Type Check Constructors
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#type-checking-rules"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Type Checking Rules
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2022 © all rights reserved</p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../assets/js/index.js"></script>
  </body>
</html>
